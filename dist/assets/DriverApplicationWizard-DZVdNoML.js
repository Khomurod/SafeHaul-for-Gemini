import{a0 as z,a3 as L,aA as P,r as n,j as e,L as v,k as F,p as c,d,H,s as S,G as w,J as G}from"./index-DL8sidqm.js";import{S as B,a as U,b as W,c as $,d as J,e as X}from"./StepReview-Dp2lNs8u.js";import{S as Y}from"./save-BKvBBKs-.js";import"./trash-2-wanxsFLc.js";import"./plus-7Y37wSRt.js";import"./upload-CA7-GPEs.js";import"./file-check-DflsTgv3.js";import"./pen-tool-D5cRxhsD.js";const o=[{id:"contact",title:"Contact Info",component:B},{id:"address",title:"Address History",component:U},{id:"license",title:"License & CDL",component:W},{id:"experience",title:"Experience & Safety",component:$},{id:"employment",title:"Employment History",component:J},{id:"review",title:"Review & Submit",component:X}];function te(){const{currentUser:s}=z(),x=L(),{companyId:u}=P(),[i,g]=n.useState(0),[r,m]=n.useState({}),[j,N]=n.useState(!0),[C,h]=n.useState(!1),[p,b]=n.useState(!1),[E,y]=n.useState(null);n.useEffect(()=>{if(u)y(u);else{const t=sessionStorage.getItem("pending_application_company");t&&y(t)}},[u]),n.useEffect(()=>{(async()=>{if(s)try{const a=c(d,"drivers",s.uid,"drafts","application"),l=await H(a);l.exists()?m(l.data()):m({email:s.email,phone:s.phoneNumber||""})}catch(a){console.error("Error loading draft:",a)}finally{N(!1)}})()},[s]);const I=async(t={})=>{if(s){h(!0);try{const a={...r,...t,lastStep:i,updatedAt:S()};m(a);const l=c(d,"drivers",s.uid,"drafts","application");await w(l,a,{merge:!0})}catch(a){console.error("Auto-save failed:",a)}finally{h(!1)}}},A=t=>{m(a=>({...a,...t}))},D=async()=>{await I(),i<o.length-1?(g(t=>t+1),window.scrollTo(0,0)):R()},_=()=>{i>0&&(g(t=>t-1),window.scrollTo(0,0))},R=async()=>{if(!r.signature||!r.signature.startsWith("TEXT_SIGNATURE")){alert("Please sign the application in the Review step.");return}if(r["consent-truth"]!=="yes"||r["consent-background"]!=="yes"){alert("You must agree to the legal statements to submit.");return}b(!0);try{const t=S(),a=E,l={...r,userId:s.uid,driverId:s.uid,status:"New Application",submittedAt:t,createdAt:t,sourceType:a?"Company App":"Global Pool",companyId:a||"general-leads"};let f;a?f=c(d,"companies",a,"applications",s.uid):f=c(d,"leads",s.uid),await w(f,l);const k=c(d,"drivers",s.uid,"drafts","application");await G(k),sessionStorage.removeItem("pending_application_company"),sessionStorage.removeItem("pending_application_recruiter"),alert("Application Submitted Successfully!"),x("/driver/dashboard")}catch(t){console.error("Submission Error:",t),alert("Failed to submit application. Please try again.")}finally{b(!1)}};if(j)return e.jsx("div",{className:"h-screen flex items-center justify-center",children:e.jsx(v,{className:"animate-spin"})});const T=o[i].component;return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-20 px-4 py-3 flex items-center justify-between shadow-sm",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>x("/driver/dashboard"),className:"text-gray-500 hover:text-gray-700 text-sm font-medium",children:"Exit"})}),e.jsxs("div",{className:"text-sm font-bold text-gray-800",children:["Step ",i+1," of ",o.length]}),e.jsx("div",{className:"w-12 flex justify-end",children:C&&e.jsxs("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(Y,{size:12})," Saving"]})})]}),e.jsx("div",{className:"w-full bg-gray-200 h-1.5",children:e.jsx("div",{className:"bg-blue-600 h-1.5 transition-all duration-300 ease-out",style:{width:`${(i+1)/o.length*100}%`}})}),e.jsxs("div",{className:"max-w-3xl mx-auto p-4 md:p-6 mt-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:o[i].title}),e.jsx(T,{data:r,onChange:A})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-30 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]",children:e.jsxs("div",{className:"max-w-3xl mx-auto w-full flex justify-between items-center",children:[e.jsx("button",{onClick:_,disabled:i===0||p,className:"px-6 py-3 rounded-xl font-bold text-gray-600 border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Back"}),e.jsx("button",{onClick:D,disabled:p,className:`px-8 py-3 rounded-xl font-bold text-white shadow-md flex items-center gap-2 transition-all transform active:scale-95 ${p?"bg-blue-400 cursor-wait":"bg-blue-600 hover:bg-blue-700"}`,children:p?e.jsxs(e.Fragment,{children:[e.jsx(v,{size:18,className:"animate-spin"})," Submitting..."]}):e.jsxs(e.Fragment,{children:[i===o.length-1?"Submit Application":"Next Step",i!==o.length-1&&e.jsx(F,{size:18})]})})]})})]})}export{te as DriverApplicationWizard};
