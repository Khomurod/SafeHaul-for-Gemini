import{aA as B,aB as _,r,j as e,L as v,_ as q,D as U,B as Y,C as W,k as $,q as G,a as A,d as b,n as O,g as X,p as J,H as K,s as M,I as Q}from"./index-DL8sidqm.js";import{S as V,a as Z,b as ee,c as te,d as se,e as ae}from"./StepReview-Dp2lNs8u.js";import"./trash-2-wanxsFLc.js";import"./plus-7Y37wSRt.js";import"./upload-CA7-GPEs.js";import"./file-check-DflsTgv3.js";import"./pen-tool-D5cRxhsD.js";const o=[{id:"contact",title:"Contact Info",component:V},{id:"address",title:"Address History",component:Z},{id:"license",title:"License & CDL",component:ee},{id:"experience",title:"Experience & Safety",component:te},{id:"employment",title:"Employment History",component:se},{id:"review",title:"Review & Submit",component:ae}];function me(){const{slug:c}=B(),[u]=_(),[S,m]=r.useState(!0),[f,x]=r.useState(""),[i,C]=r.useState(null),[P,k]=r.useState(null),[n,j]=r.useState(0),[t,E]=r.useState({}),[p,N]=r.useState(!1),[H,T]=r.useState(!1),w=r.useRef(!1);r.useEffect(()=>{if(w.current)return;w.current=!0;async function l(){if(!c){x("Invalid link - no company specified."),m(!1);return}console.log("[PublicApplyHandler] Loading company for slug:",c);try{let s=null,a=null;const y=G(A(b,"companies"),O("appSlug","==",c)),d=await X(y);if(!d.empty)a=d.docs[0].id,s={id:a,...d.docs[0].data()},console.log("[PublicApplyHandler] Found company:",s.companyName);else{const F=J(b,"companies",c),g=await K(F);g.exists()&&(a=g.id,s={id:a,...g.data()},console.log("[PublicApplyHandler] Found company by ID:",s.companyName))}if(!s){x("Company not found. Please check the link and try again."),m(!1);return}C(s);const h=u.get("r")||u.get("recruiter");h&&(console.log("[PublicApplyHandler] Recruiter code:",h),k(h)),m(!1)}catch(s){console.error("[PublicApplyHandler] Error loading company:",s),x("Unable to load application. Please try again later."),m(!1)}}l()},[c,u]);const D=l=>{E(s=>({...s,...l}))},L=()=>{n<o.length-1?(j(l=>l+1),window.scrollTo(0,0)):z()},R=()=>{n>0&&(j(l=>l-1),window.scrollTo(0,0))},z=async()=>{if(!t.signature||!t.signature.startsWith("TEXT_SIGNATURE")){alert("Please sign the application in the Review step.");return}if(["consent-truth","consent-background","consent-mvr","consent-psp","consent-clearinghouse"].filter(a=>t[a]!=="yes").length>0){alert("You must agree to all legal statements and authorizations to submit.");return}N(!0);try{const a=M(),y={...t,employers:Array.isArray(t.employers)?t.employers:[],violations:Array.isArray(t.violations)?t.violations:[],accidents:Array.isArray(t.accidents)?t.accidents:[],unemployment:Array.isArray(t.unemployment)?t.unemployment:[],schools:Array.isArray(t.schools)?t.schools:[],military:Array.isArray(t.military)?t.military:[],endorsements:Array.isArray(t.endorsements)?t.endorsements:[],driverType:Array.isArray(t.driverType)?t.driverType:[],companyId:i.id,companyName:i.companyName,recruiterCode:P||null,sourceType:"Public Application",sourceSlug:c,status:"New Application",submittedAt:a,createdAt:a},d=A(b,"companies",i.id,"applications");await Q(d,y),console.log("[PublicApplyHandler] Application submitted successfully!"),T(!0)}catch(a){console.error("[PublicApplyHandler] Submission error:",a),alert("Failed to submit application. Please try again.")}finally{N(!1)}};if(S)return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center",children:[e.jsx(v,{className:"animate-spin text-blue-600 mb-4",size:48}),e.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:"Loading Application..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Please wait while we connect you."})]});if(f)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-xl shadow-lg border border-red-100 text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(q,{size:32})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Link Error"}),e.jsx("p",{className:"text-gray-600",children:f})]})});if(H)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-xl text-center max-w-md",children:[e.jsx("div",{className:"w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(U,{size:48})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Application Submitted!"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["Thank you for applying to ",e.jsx("strong",{children:i.companyName}),". Your application has been received and a recruiter will contact you soon."]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 text-left",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"What happens next?"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Our team will review your application"}),e.jsx("li",{children:"• You'll receive a call or email within 1-2 business days"}),e.jsx("li",{children:"• Have your CDL and documents ready for verification"})]})]})]})});const I=o[n].component;return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-20 px-4 py-3 shadow-sm",children:e.jsxs("div",{className:"max-w-3xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[i.logoUrl?e.jsx("img",{src:i.logoUrl,alt:i.companyName,className:"h-8 w-auto"}):e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Y,{size:18,className:"text-blue-600"})}),e.jsx("span",{className:"font-bold text-gray-900",children:i.companyName})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-500",children:["Step ",n+1," of ",o.length]})]})}),e.jsx("div",{className:"w-full bg-gray-200 h-1.5",children:e.jsx("div",{className:"bg-blue-600 h-1.5 transition-all duration-300 ease-out",style:{width:`${(n+1)/o.length*100}%`}})}),e.jsxs("div",{className:"max-w-3xl mx-auto p-4 md:p-6 mt-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:o[n].title}),e.jsx(I,{data:t,onChange:D})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-30 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]",children:e.jsxs("div",{className:"max-w-3xl mx-auto w-full flex justify-between items-center",children:[e.jsxs("button",{onClick:R,disabled:n===0||p,className:"px-6 py-3 rounded-xl font-bold text-gray-600 border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(W,{size:18,className:"inline mr-1"}),"Back"]}),e.jsx("button",{onClick:L,disabled:p,className:`px-8 py-3 rounded-xl font-bold text-white shadow-md flex items-center gap-2 transition-all transform active:scale-95 ${p?"bg-blue-400 cursor-wait":"bg-blue-600 hover:bg-blue-700"}`,children:p?e.jsxs(e.Fragment,{children:[e.jsx(v,{size:18,className:"animate-spin"})," Submitting..."]}):e.jsxs(e.Fragment,{children:[n===o.length-1?"Submit Application":"Next Step",n!==o.length-1&&e.jsx($,{size:18})]})})]})})]})}export{me as PublicApplyHandler};
