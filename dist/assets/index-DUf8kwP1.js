import{c as te,C as d,Y as Q,D as e,X as ne,$ as de,f as q,a as R,q as _,af as V,e as I,L as M,a3 as ge,ac as je,ah as Ne,W as oe,ab as K,E as ye,Z as ve,a4 as we,d as L,T as ae,g as ce,ae as G,r as Y,s as W,u as xe,i as me,ai as ue,a2 as pe,aj as k,M as ee,P as ie,ak as Se,x as De,B as ke,a8 as Z}from"./index-Eut2KIY5.js";import{F as $}from"./file-text-fIi5thw4.js";import{S as P,a as Ce}from"./shield-B8dSCmK2.js";import{S as Ee}from"./shield-alert-CyrU0uX3.js";import{S as O}from"./index-BbXgOzvQ.js";import{l as X}from"./BulkUploadLayout-DCFrYteR.js";import{U as he}from"./upload-CeDmLZPo.js";import{D as re}from"./external-link-DG7NPcwU.js";import{T as be}from"./trash-2-RTc4kdO5.js";import{S as le}from"./send-DbngQNm2.js";import{H as Ae}from"./history-1Q_UTirS.js";import{P as Te}from"./plus-DHyG1REA.js";import"./pdfjs-CN6VhWT3.js";import"./credit-card-DXG0d7j1.js";import"./file-pen-line-CZApjMvZ.js";import"./user-check-BzH4u_-N.js";import"./dollar-sign-DE8xXdSp.js";import"./pen-DKw8HDfG.js";import"./save-xDZOd2sT.js";import"./useBulkImport-DleduGt8.js";const ze=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]],Fe=te("circle-dot",ze);const Re=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],se=te("printer",Re);const Pe=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],fe=te("refresh-ccw",Pe);function Me({employer:l,applicant:n,onClose:m,onProceed:N}){const[c,u]=d.useState("email"),[p,f]=d.useState({email:l.email||"",fax:l.fax||"",phone:l.phone||""}),y=[{id:"email",label:"E-mail Delivery",icon:Q,description:"Send a digital form link to the employer.",active:!!l.email},{id:"fax",label:"Fax Transmission",icon:se,description:"Electronic fax delivery to the carrier.",active:!!l.fax},{id:"manual",label:"Download / Print",icon:$,description:"Download PDF to mail or email manually.",active:!0}];return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-[80] flex items-center justify-center p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"bg-slate-900 p-6 text-white relative",children:[e.jsx("button",{onClick:m,className:"absolute top-4 right-4 p-2 hover:bg-white/10 rounded-full transition",children:e.jsx(ne,{size:20})}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-500 rounded-lg",children:e.jsx(P,{size:24})}),e.jsx("h3",{className:"text-xl font-bold",children:"Initiate Verification"})]}),e.jsxs("p",{className:"text-slate-400 text-sm",children:["Verify employment for ",e.jsx("span",{className:"text-white font-semibold",children:l.name})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:"Select Delivery Method"}),e.jsx("div",{className:"grid gap-3",children:y.map(h=>e.jsxs("button",{onClick:()=>u(h.id),className:`flex items-center gap-4 p-4 rounded-xl border-2 transition-all text-left group ${c===h.id?"border-blue-600 bg-blue-50":"border-gray-100 hover:border-gray-200 hover:bg-gray-50"}`,children:[e.jsx("div",{className:`p-3 rounded-lg transition-colors ${c===h.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-500 group-hover:bg-gray-200"}`,children:e.jsx(h.icon,{size:20})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-bold ${c===h.id?"text-blue-900":"text-gray-700"}`,children:h.label}),!h.active&&e.jsx("span",{className:"text-[10px] bg-amber-100 text-amber-700 px-1.5 py-0.5 rounded font-bold uppercase",children:"Missing Info"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:h.description})]}),e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center transition-all ${c===h.id?"border-blue-600 bg-blue-600":"border-gray-200"}`,children:c===h.id&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-white"})})]},h.id))})]}),c==="email"&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-200 animate-in slide-in-from-top-2",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-2",children:"Recipient Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(Q,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"email",value:p.email,onChange:h=>f({...p,email:h.target.value}),className:"w-full pl-10 pr-4 py-2 bg-white border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-600 outline-none transition-all",placeholder:"hr@company.com"})]})]}),c==="fax"&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl border border-gray-200 animate-in slide-in-from-top-2",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-2",children:"Recipient Fax Number"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"tel",value:p.fax,onChange:h=>f({...p,fax:h.target.value}),className:"w-full pl-10 pr-4 py-2 bg-white border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-600 outline-none transition-all",placeholder:"(555) 000-0000"})]})]}),e.jsxs("div",{className:"flex gap-3 p-3 bg-amber-50 rounded-lg border border-amber-100",children:[e.jsx(de,{size:18,className:"text-amber-600 shrink-0"}),e.jsx("p",{className:"text-[11px] text-amber-800 leading-relaxed font-medium",children:"Verifications are performed in compliance with FMCSA 49 CFR Part 391.23. The driver's signed authorization is attached to the request automatically."})]})]}),e.jsxs("div",{className:"p-6 bg-gray-50 border-t border-gray-100 flex gap-3",children:[e.jsx("button",{onClick:m,className:"flex-1 py-3 text-sm font-bold text-gray-600 hover:bg-gray-100 rounded-xl transition-colors border border-gray-200 bg-white",children:"Cancel"}),e.jsxs("button",{onClick:()=>{if(c==="email"&&!p.email)return alert("Please provide a valid recipient email.");if(c==="fax"&&!p.fax)return alert("Please provide a valid fax number.");N(c,p)},className:"flex-1 py-3 text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 rounded-xl transition-all shadow-md shadow-blue-100 flex items-center justify-center gap-2",children:[e.jsx(le,{size:18}),c==="manual"?"Preview & Print":"Continue to Preview"]})]})]})})}function is({companyId:l,applicationId:n,collectionName:m}){const[N,c]=d.useState([]),[u,p]=d.useState(!0),[f,y]=d.useState("all");d.useEffect(()=>{l&&n&&h()},[l,n,m]);const h=async()=>{p(!0);try{const r=q(R,"companies",l,m==="leads"?"leads":"applications",n,"activity_logs"),s=_(r,V("timestamp","desc")),D=(await I(s)).docs.map(v=>({id:v.id,...v.data()}));c(D)}catch(i){console.error("Error loading history:",i)}finally{p(!1)}},C=(i,r)=>{const s=r.toLowerCase(),S=(i||"").toLowerCase();return S==="call"||s.includes("call")?e.jsx(Ne,{size:16,className:"text-emerald-600"}):s.includes("note")?e.jsx(oe,{size:16,className:"text-gray-600"}):s.includes("email")?e.jsx(Q,{size:16,className:"text-indigo-600"}):s.includes("assigned")?e.jsx(fe,{size:16,className:"text-orange-600"}):s.includes("status")?s.includes("approved")||s.includes("hired")?e.jsx(K,{size:16,className:"text-purple-600"}):s.includes("rejected")||s.includes("disqualified")?e.jsx(ye,{size:16,className:"text-red-500"}):e.jsx(Fe,{size:16,className:"text-blue-600"}):S==="upload"||s.includes("file")||s.includes("document")?e.jsx($,{size:16,className:"text-green-600"}):s.includes("pev")||s.includes("verification")?e.jsx(P,{size:16,className:"text-amber-600"}):s.includes("converted")?e.jsx(ve,{size:16,className:"text-yellow-600"}):s.includes("settings")||s.includes("updated")?e.jsx(Ee,{size:16,className:"text-gray-400"}):e.jsx(we,{size:16,className:"text-gray-400"})},w=d.useMemo(()=>f==="all"?N:N.filter(i=>{const r=i.action.toLowerCase(),s=(i.type||"").toLowerCase();return f==="calls"?s==="call"||r.includes("call"):f==="notes"?r.includes("note"):f==="status"?r.includes("status"):f==="documents"?s==="upload"||r.includes("file")||r.includes("document"):!0}),[N,f]),E=d.useMemo(()=>{const i={};return w.forEach(r=>{if(!r.timestamp){i.Recent||(i.Recent=[]),i.Recent.push(r);return}const s=new Date(r.timestamp.seconds*1e3),S=new Date,D=new Date;D.setDate(S.getDate()-1);let v="";s.toDateString()===S.toDateString()?v="Today":s.toDateString()===D.toDateString()?v="Yesterday":v=s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),i[v]||(i[v]=[]),i[v].push(r)}),i},[w]);return u?e.jsx("div",{className:"p-10 text-center",children:e.jsx(M,{className:"animate-spin mx-auto text-blue-600"})}):e.jsxs("div",{className:"flex flex-col h-full bg-white rounded-xl",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between bg-gray-50/50 rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{size:18,className:"text-gray-400"}),e.jsx("h3",{className:"text-sm font-bold text-gray-700 uppercase tracking-wider",children:"Audit Trail"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{size:14,className:"text-gray-400"}),e.jsxs("select",{value:f,onChange:i=>y(i.target.value),className:"text-xs font-bold bg-white border border-gray-200 rounded-lg px-2 py-1 outline-none focus:ring-2 focus:ring-blue-500 transition-all cursor-pointer",children:[e.jsx("option",{value:"all",children:"All Activities"}),e.jsx("option",{value:"calls",children:"Calls"}),e.jsx("option",{value:"notes",children:"Notes"}),e.jsx("option",{value:"status",children:"Status Changes"}),e.jsx("option",{value:"documents",children:"Documents"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 scrollbar-thin scrollbar-thumb-gray-200",children:N.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400 border-2 border-dashed border-gray-100 rounded-xl",children:[e.jsx($,{size:32,className:"mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"No activity recorded for this driver."})]}):w.length===0?e.jsx("div",{className:"p-10 text-center text-gray-500 italic",children:"No activities match the selected filter."}):e.jsxs("div",{className:"space-y-8 relative",children:[e.jsx("div",{className:"absolute left-[15px] top-2 bottom-2 w-0.5 bg-gray-100"}),Object.entries(E).map(([i,r])=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider pl-8 mb-2 flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-300"}),i]}),r.map(s=>e.jsxs("div",{className:"relative pl-10 group/item",children:[e.jsx("div",{className:"absolute left-0 top-0 w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center z-10 shadow-sm group-hover/item:border-blue-400 transition-colors",children:C(s.type,s.action)}),e.jsxs("div",{className:"bg-white border border-gray-100 rounded-xl p-4 shadow-sm group-hover/item:shadow-md transition-all group-hover/item:border-blue-100",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-gray-800 text-sm",children:s.action}),s.outcomeLabel&&e.jsx("span",{className:"px-2 py-0.5 bg-blue-50 text-blue-600 text-[10px] font-semibold rounded-full border border-blue-100",children:s.outcomeLabel})]}),e.jsx("span",{className:"text-[10px] font-mono text-gray-400",children:s.timestamp?new Date(s.timestamp.seconds*1e3).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Pending"})]}),s.details&&e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed font-medium whitespace-pre-wrap",children:s.details}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-[11px] font-semibold text-gray-500",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center text-[9px]",children:s.performedByName?.charAt(0)||"S"}),s.performedByName||"System Auto"]}),s.type==="call"&&s.duration&&e.jsxs("span",{className:"text-[11px] text-gray-400 font-medium",children:["Duration: ",s.duration,"s"]})]})]})]},s.id))]},i))]})})]})}const J=["Application for Employment","Previous Employer Inquiry (3yr)","MVR (Annual)","Medical Card","Road Test Certificate","PSP Report","Clearinghouse Report (Full)","Clearinghouse Report (Annual)","Certificate of Violations (Annual)","Annual Review","Other"];function ns({companyId:l,applicationId:n,collectionName:m="applications"}){const[N,c]=d.useState([]),[u,p]=d.useState(!0),[f,y]=d.useState(!1),[h,C]=d.useState(""),[w,E]=d.useState(""),[i,r]=d.useState(null),[s,S]=d.useState(J[0]),D=d.useMemo(()=>{const t=L(R,"companies",l,m,n);return q(t,"dq_files")},[l,n,m]),v=t=>{if(!t)return null;const x=new Date,b=new Date(t)-x,j=Math.ceil(b/(1e3*60*60*24));return j<0?{label:"EXPIRED",color:"bg-red-100 text-red-800 border-red-200"}:j<30?{label:`Expiring in ${j} days`,color:"bg-yellow-100 text-yellow-800 border-yellow-200"}:{label:"Active",color:"bg-green-100 text-green-800 border-green-200"}},A=async()=>{p(!0),E("");try{const t=_(D,V("createdAt","desc")),a=(await I(t)).docs.map(T=>({id:T.id,...T.data()})),b=L(R,"companies",l,m,n),j=await ce(b);let F=0;if(j.exists()){const T=j.data(),H=[{field:"medical-card-upload",type:"Medical Card",expirationField:"medCardExpiration"},{field:"cdl-front",type:"CDL (Front)",expirationField:"cdlExpiration"},{field:"cdl-back",type:"CDL (Back)",expirationField:"cdlExpiration"},{field:"twic-card-upload",type:"TWIC Card",expirationField:"twicExpiration"},{field:"mvr-upload",type:"MVR (Annual)"}];for(const z of H){const U=T[z.field];if(U&&U.url&&!a.some(B=>B.url===U.url)){console.log(`Syncing ${z.type}...`);const B={fileType:z.type,fileName:U.name||"Auto-Synced File",url:U.url,storagePath:U.storagePath||"",createdAt:new Date,isSynced:!0,sourceField:z.field};z.expirationField&&T[z.expirationField]&&(B.expirationDate=T[z.expirationField]),await G(D,B),F++}}}if(F>0){const T=_(D,V("createdAt","desc")),H=await I(T);c(H.docs.map(z=>({id:z.id,...z.data()})))}else c(a)}catch(t){console.error("Error fetching/syncing DQ files:",t),E("Could not load DQ files. Check permissions.")}finally{p(!1)}};d.useEffect(()=>{A()},[D]);const o=async()=>{if(!i||!s){E("Please select a file and a file type.");return}y(!0),C("Uploading file..."),E("");try{const t=`companies/${l}/applications/${n}/dq_files/${s.replace(/[^a-zA-Z0-9]/g,"_")}_${i.name}`,x=Y(W,t);await xe(x,i);const a=await me(x);C("Saving to database...");const b={fileType:s,fileName:i.name,url:a,storagePath:t,createdAt:new Date};await G(D,b),await X(l,m,n,"dq_file_uploaded",`Uploaded DQ file: ${s} - ${i.name}`,"user"),C("Upload Complete!"),r(null),S(J[0]),document.getElementById("dq-file-input").value=null,await A(),setTimeout(()=>C(""),2e3)}catch(t){console.error("Upload failed:",t),E(`Upload failed: ${t.message}`)}finally{y(!1)}},g=async t=>{if(window.confirm(`Are you sure you want to delete "${t.fileName}"?`)){p(!0),E("");try{const x=Y(W,t.storagePath);await ue(x);const a=L(D,t.id);await pe(a),await X(l,m,n,"dq_file_deleted",`Deleted DQ file: ${t.fileType} - ${t.fileName}`,"user"),await A()}catch(x){console.error("Delete failed:",x),E(`Delete failed: ${x.message}`),p(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(O,{title:"Add New DQ File",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dq-file-type",className:"block text-sm font-medium text-gray-700 mb-1",children:"File Type"}),e.jsx("select",{id:"dq-file-type",className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white",value:s,onChange:t=>S(t.target.value),disabled:f,children:J.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"dq-file-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"File"}),e.jsx("input",{type:"file",id:"dq-file-input",className:`w-full text-sm text-gray-700
                         file:mr-4 file:py-2 file:px-4
                         file:rounded-lg file:border-0
                         file:text-sm file:font-semibold
                         file:bg-blue-50 file:text-blue-700
                         hover:file:bg-blue-100`,onChange:t=>r(t.target.files[0]),disabled:f})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{className:"w-full sm:w-auto py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150 disabled:opacity-75",onClick:o,disabled:f||!i,children:[f?e.jsx(M,{className:"animate-spin"}):e.jsx(he,{size:20}),e.jsx("span",{className:"ml-2",children:f?"Uploading...":"Upload File"})]}),h&&e.jsx("p",{className:"text-sm text-green-600",children:h})]}),w&&e.jsxs("p",{className:"text-sm text-red-600 p-3 bg-red-50 rounded-lg flex items-center gap-2",children:[e.jsx(ae,{size:16})," ",w]})]})}),e.jsx(O,{title:"Current DQ Files",children:e.jsxs("div",{className:"space-y-3",children:[u&&e.jsx("div",{className:"flex justify-center items-center p-4",children:e.jsx(M,{className:"animate-spin text-gray-500"})}),!u&&N.length===0&&e.jsx("p",{className:"text-gray-500 italic text-center p-4",children:"No DQ files have been uploaded for this driver."}),!u&&N.map(t=>{const x=v(t.expirationDate);return e.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 bg-gray-50 border border-gray-200 rounded-lg hover:shadow-sm transition",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx($,{size:20,className:"text-blue-600 shrink-0"}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.fileType}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-xs text-gray-600 truncate",title:t.fileName,children:t.fileName}),x&&e.jsxs("span",{className:`text-[10px] px-2 py-0.5 rounded-full border font-medium ${x.color}`,children:[x.label," (",t.expirationDate,")"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all",title:"Download File",children:e.jsx(re,{size:18})}),e.jsx("button",{className:"p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-all",title:"Delete File",onClick:()=>g(t),children:e.jsx(be,{size:18})})]})]},t.id)})]})})]})}const Ue=[{key:"cdl-front",label:"CDL (Front)"},{key:"cdl-back",label:"CDL (Back)"},{key:"medical-card-upload",label:"Medical Card"},{key:"twic-card-upload",label:"TWIC Card"},{key:"mvr-consent-upload",label:"MVR Consent Form"},{key:"drug-test-consent-upload",label:"Drug Test Consent"}];function ds({companyId:l,applicationId:n,appData:m,collectionName:N="applications"}){const[c,u]=d.useState([]),[p,f]=d.useState(!0),[y,h]=d.useState(!1),[C,w]=d.useState(""),[E,i]=d.useState(""),[r,s]=d.useState(null),[S,D]=d.useState(""),v=d.useMemo(()=>{const a=L(R,"companies",l,N,n);return q(a,"general_documents")},[l,n,N]),A=async()=>{f(!0),i("");try{const a=_(v,V("createdAt","desc")),j=(await I(a)).docs.map(F=>({id:F.id,...F.data(),isReadonly:!1,source:"Uploaded"}));u(j)}catch(a){console.error("Error fetching general documents:",a),i("Could not load documents. Check permissions.")}finally{f(!1)}};d.useEffect(()=>{A()},[v]);const o=d.useMemo(()=>m?Ue.map(a=>{const b=m[a.key];return!b||!b.url?null:{id:a.key,description:a.label,fileName:b.name,url:b.url,storagePath:b.storagePath,isReadonly:!0,source:"Application"}}).filter(a=>a!==null):[],[m]),g=d.useMemo(()=>{const a=o.map(j=>({...j,createdAt:{seconds:0}})),b=[...c,...a];return b.sort((j,F)=>{const T=j.createdAt?.seconds||0;return(F.createdAt?.seconds||0)-T}),b},[o,c]),t=async()=>{if(!r){i("Please select a file to upload.");return}h(!0),w("Uploading file..."),i("");try{const a=`companies/${l}/applications/${n}/general_documents/${Date.now()}_${r.name}`,b=Y(W,a);await xe(b,r);const j=await me(b);w("Saving to database...");const F={description:S||"No description",fileName:r.name,url:j,storagePath:a,createdAt:new Date};await G(v,F),w("Upload Complete!"),s(null),D(""),document.getElementById("general-file-input").value=null,await A(),setTimeout(()=>w(""),2e3)}catch(a){console.error("Upload failed:",a),i(`Upload failed: ${a.message}`)}finally{h(!1)}},x=async a=>{if(window.confirm(`Are you sure you want to delete "${a.fileName}"?`)){f(!0),i("");try{const b=Y(W,a.storagePath);await ue(b);const j=L(v,a.id);await pe(j),await A()}catch(b){console.error("Delete failed:",b),i(`Delete failed: ${b.message}`),f(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(O,{title:"Upload a New Document",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"file-description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description (Optional)"}),e.jsx("input",{type:"text",id:"file-description",className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"E.g., Incident Report, Updated Insurance...",value:S,onChange:a=>D(a.target.value),disabled:y})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"general-file-input",className:"block text-sm font-medium text-gray-700 mb-1",children:"File"}),e.jsx("input",{type:"file",id:"general-file-input",className:`w-full text-sm text-gray-700
                         file:mr-4 file:py-2 file:px-4
                         file:rounded-lg file:border-0
                         file:text-sm file:font-semibold
                         file:bg-blue-50 file:text-blue-700
                         hover:file:bg-blue-100`,onChange:a=>s(a.target.files[0]),disabled:y})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{className:"w-full sm:w-auto py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-150 disabled:opacity-75",onClick:t,disabled:y||!r,children:[y?e.jsx(M,{className:"animate-spin"}):e.jsx(he,{size:20}),e.jsx("span",{className:"ml-2",children:y?"Uploading...":"Upload File"})]}),C&&e.jsx("p",{className:"text-sm text-green-600",children:C})]}),E&&e.jsxs("p",{className:"text-sm text-red-600 p-3 bg-red-50 rounded-lg flex items-center gap-2",children:[e.jsx(ae,{size:16})," ",E]})]})}),e.jsx(O,{title:"All Documents",children:e.jsxs("div",{className:"space-y-3",children:[p&&e.jsx("div",{className:"flex justify-center items-center p-4",children:e.jsx(M,{className:"animate-spin text-gray-500"})}),!p&&g.length===0&&e.jsx("p",{className:"text-gray-500 italic text-center p-4",children:"No documents have been uploaded for this driver."}),!p&&g.map(a=>e.jsxs("div",{className:"flex items-center justify-between gap-3 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[a.isReadonly?e.jsx(Ce,{size:20,className:"text-green-600 shrink-0"}):e.jsx($,{size:20,className:"text-gray-500 shrink-0"}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:k(a.description),children:k(a.description)}),e.jsx("p",{className:"text-xs text-gray-600 truncate",title:a.fileName,children:a.fileName})]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0 items-center",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-semibold rounded-full
                    ${a.isReadonly?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}
                  `,children:a.source}),e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all",title:"Download File",children:e.jsx(re,{size:18})}),!a.isReadonly&&e.jsx("button",{className:"p-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-all",title:"Delete File",onClick:()=>x(a),children:e.jsx(be,{size:18})})]})]},a.id))]})})]})}function Le({size:l}){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:l,height:l,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),e.jsx("path",{d:"M12 11h.01"})]})}function os({companyId:l,applicationId:n,collectionName:m="applications"}){const[N,c]=d.useState([]),[u,p]=d.useState(""),[f,y]=d.useState(!0),[h,C]=d.useState(!1),[w,E]=d.useState(null);d.useEffect(()=>{async function r(){y(!0);try{const s=q(R,"companies",l,m,n,"internal_notes"),S=_(s,V("createdAt","desc")),v=(await I(S)).docs.map(x=>({id:x.id,...x.data(),isLocal:!0})),A=L(R,"companies",l,m,n),o=await ce(A);let g=[];o.exists()&&o.data().sharedHistory&&(g=(o.data().sharedHistory||[]).map((a,b)=>({id:`shared_${b}`,text:a.text,author:"Previous Recruiter",createdAt:a.date,type:"note",isLocal:!1,isShared:!0})));const t=[...v,...g].sort((x,a)=>{const b=j=>j?j.seconds?j.seconds*1e3:j instanceof Date?j.getTime():new Date(j).getTime():0;return b(a.createdAt)-b(x.createdAt)});if(c(t),ie.currentUser){const x=await Se(ie.currentUser.uid);E(x?x.name:"Admin")}}catch(s){console.error("Error loading notes:",s)}finally{y(!1)}}r()},[l,n,m]);const i=async r=>{if(r.preventDefault(),!!u.trim()){C(!0);try{const s=q(R,"companies",l,m,n,"internal_notes");await G(s,{text:u,author:w,createdAt:De(),type:"note"}),await X(l,m,n,"Note Added",u.substring(0,100)+(u.length>100?"...":""),"note");const S={id:Date.now().toString(),text:u,author:w,createdAt:{seconds:Date.now()/1e3},type:"note",isLocal:!0};c([S,...N]),p("")}catch(s){console.error("Failed to add note:",s),alert("Failed to save note.")}finally{C(!1)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-2",children:"Internal Note (Private)"}),e.jsxs("form",{onSubmit:i,children:[e.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm outline-none",rows:"3",placeholder:"Log a call, interview notes, or reason for rejection...",value:u,onChange:r=>p(r.target.value)}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsxs("p",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(Le,{size:12})," Visible only to your team"]}),e.jsxs("button",{type:"submit",disabled:!u.trim()||h,className:"px-4 py-2 bg-blue-600 text-white text-sm font-bold rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2 transition-all",children:[h?e.jsx(M,{className:"animate-spin",size:16}):e.jsx(le,{size:16}),"Add Note"]})]})]})]}),e.jsx("div",{className:"space-y-4",children:f?e.jsx("div",{className:"text-center py-10",children:e.jsx(M,{className:"animate-spin mx-auto text-gray-400"})}):N.length===0?e.jsxs("div",{className:"text-center py-10 bg-gray-50 rounded-xl border border-dashed border-gray-300",children:[e.jsx(oe,{className:"mx-auto text-gray-300 mb-2",size:32}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No notes yet."})]}):N.map(r=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"mt-1 flex-shrink-0",children:r.isShared?e.jsx("div",{className:"w-8 h-8 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center text-xs font-bold border border-purple-200",title:"Shared History",children:e.jsx(Ae,{size:14})}):e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-500 text-xs font-bold",children:r.author?r.author.charAt(0).toUpperCase():"A"})}),e.jsxs("div",{className:`flex-1 p-3 rounded-lg rounded-tl-none border ${r.isShared?"bg-purple-50 border-purple-100":"bg-gray-50 border-gray-200"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs font-bold ${r.isShared?"text-purple-800":"text-gray-700"}`,children:r.author||"Unknown"}),r.isShared&&e.jsx("span",{className:"text-[9px] uppercase font-bold bg-purple-200 text-purple-800 px-1.5 py-0.5 rounded",children:"Shared History"})]}),e.jsxs("span",{className:"text-[10px] text-gray-400 flex items-center gap-1",children:[e.jsx(ee,{size:10}),r.createdAt?.seconds?new Date(r.createdAt.seconds*1e3).toLocaleString():new Date(r.createdAt).toLocaleString()!=="Invalid Date"?new Date(r.createdAt).toLocaleString():"Just now"]})]}),e.jsx("p",{className:"text-sm text-gray-800 whitespace-pre-wrap leading-relaxed",children:r.text})]})]},r.id))})]})}function $e({employer:l,applicant:n,onClose:m,onSend:N}){if(!l||!n)return null;const c=n.signature&&!n.signature.startsWith("TEXT_SIGNATURE")?n.signature:null,u=n.signature&&n.signature.startsWith("TEXT_SIGNATURE")?n.signature.replace("TEXT_SIGNATURE:",""):null;return e.jsx("div",{className:"fixed inset-0 bg-black/70 z-[80] flex items-center justify-center p-4 backdrop-blur-md",children:e.jsxs("div",{className:"bg-slate-100 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[95vh] flex flex-col overflow-hidden animate-in fade-in zoom-in-95",children:[e.jsxs("div",{className:"p-4 bg-slate-900 text-white flex justify-between items-center px-8 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg",children:e.jsx(P,{size:20})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-bold tracking-tight",children:"Employment Verification Preview"}),e.jsx("p",{className:"text-[10px] text-slate-400 font-medium uppercase tracking-widest",children:"Document Generated by SafeHaul HR Services"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:m,className:"p-2 hover:bg-white/10 rounded-full transition-colors text-slate-400 hover:text-white",children:e.jsx(ne,{size:20})})})]}),e.jsxs("div",{className:"bg-white border-b border-gray-200 px-8 py-3 flex justify-between items-center shrink-0",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),"RECIPIENT: ",k(l.name)]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-bold text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),"APPLICANT: ",k(n.firstName)," ",k(n.lastName)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 text-xs font-bold text-gray-600 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200",children:[e.jsx(se,{size:14})," Print"]}),e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 text-xs font-bold text-gray-600 hover:bg-gray-100 rounded-lg transition-colors border border-gray-200",children:[e.jsx(re,{size:14})," Download PDF"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-12 bg-slate-200/50 scrollbar-thin scrollbar-thumb-slate-300",children:e.jsxs("div",{className:"bg-white border border-gray-300 shadow-xl p-12 max-w-3xl mx-auto min-h-[1000px] font-serif text-slate-900 leading-relaxed",children:[e.jsxs("div",{className:"flex justify-between items-start mb-12 border-b-2 border-slate-900 pb-8",children:[e.jsxs("div",{className:"text-left",children:[e.jsx("h1",{className:"text-2xl font-black uppercase tracking-tighter mb-1",children:"SAFEHAUL"}),e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest text-slate-500",children:"Compliance & Verification Services"}),e.jsxs("p",{className:"text-[10px] text-slate-400 mt-2 font-sans italic",children:["Generated on ",new Date().toLocaleDateString()," at ",new Date().toLocaleTimeString()]})]}),e.jsx("div",{className:"text-right",children:e.jsx("h2",{className:"text-xl font-bold uppercase tracking-widest border-2 border-slate-900 px-4 py-2",children:"VOE-391.23"})})]}),e.jsxs("div",{className:"text-center mb-10",children:[e.jsx("h3",{className:"text-xl font-bold uppercase underline decoration-2 underline-offset-8",children:"Request for Verification of Employment"}),e.jsx("p",{className:"text-xs font-bold mt-4 text-slate-600 font-sans px-8 py-2 bg-slate-50 border border-slate-100 rounded",children:"This request is made pursuant to the Federal Motor Carrier Safety Regulations (FMCSR) 49 CFR Part 391.23. This regulation requires prospective employers to investigate a driver's background through the driver's previous employers."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-12 mb-10 font-sans",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-blue-600 border-b-2 border-blue-500 mb-3 tracking-widest",children:"To (Previous Employer)"}),e.jsxs("div",{className:"text-sm font-bold uppercase space-y-1",children:[e.jsx("p",{className:"text-lg",children:k(l.name)}),e.jsxs("p",{className:"text-slate-600 font-medium",children:[k(l.city),", ",k(l.state)]}),l.email&&e.jsx("p",{className:"text-blue-600 normal-case",children:l.email}),l.phone&&e.jsx("p",{className:"text-slate-500",children:l.phone})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-500 border-b-2 border-slate-400 mb-3 tracking-widest",children:"From (Prospective Employer)"}),e.jsxs("div",{className:"text-sm font-bold uppercase space-y-1",children:[e.jsx("p",{className:"text-lg",children:"[PROSPECTIVE COMPANY]"}),e.jsx("p",{className:"text-slate-600 font-medium",children:"SafeHaul Network Member"}),e.jsx("p",{className:"text-slate-500 normal-case italic opacity-50",children:"Verified Business Entity"})]})]})]}),e.jsxs("div",{className:"mb-10 font-sans bg-slate-50 p-6 border border-slate-200",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-700 mb-4 tracking-widest",children:"Subject Applicant Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-4 text-sm font-bold",children:[e.jsxs("div",{className:"border-b border-slate-200 pb-1",children:[e.jsx("span",{className:"text-[10px] uppercase text-slate-400 block mb-0.5",children:"Full Name"}),k(n.firstName)," ",k(n.lastName)]}),e.jsxs("div",{className:"border-b border-slate-200 pb-1",children:[e.jsx("span",{className:"text-[10px] uppercase text-slate-400 block mb-0.5",children:"Social Security Number"}),n.ssn?`***-**-${n.ssn.slice(-4)}`:"REDACTED (ON FILE)"]}),e.jsxs("div",{className:"border-b border-slate-200 pb-1",children:[e.jsx("span",{className:"text-[10px] uppercase text-slate-400 block mb-0.5",children:"Date of Birth"}),n.dob||"NOT DISCLOSED"]}),e.jsxs("div",{className:"border-b border-slate-200 pb-1",children:[e.jsx("span",{className:"text-[10px] uppercase text-slate-400 block mb-0.5",children:"Reported Service Dates"}),k(l.dates)]})]})]}),e.jsxs("div",{className:"mb-12 border-2 border-slate-900 p-8 relative overflow-hidden bg-slate-50/30",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-[0.03] pointer-events-none rotate-12 -z-10",children:e.jsx(P,{size:400})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"p-2 bg-blue-600 text-white rounded-lg",children:e.jsx(P,{size:20})}),e.jsx("h4",{className:"text-xl font-bold uppercase underline decoration-blue-600 decoration-4 underline-offset-4",children:"Legal Release & Authorization"})]}),e.jsxs("p",{className:"text-[13px] text-justify mb-10 leading-relaxed text-slate-800 font-medium border-l-4 border-blue-500 pl-6 py-2",children:["I, the undersigned applicant, hereby provide specific written consent and authorize the release of all information requested by SafeHaul HR Verification Services on behalf of the prospective employer. In accordance with ",e.jsx("span",{className:"font-bold",children:"49 CFR §391.23"})," and ",e.jsx("span",{className:"font-bold",children:"§40.321"}),", this includes, but is not limited to: my complete employment history, safety performance history, accident records, and all results of drug and alcohol testing (including any refusals to test or violations of Part 382). I release all previous employers and their agents from any and all liability which may result from furnishing such information in good faith."]}),e.jsxs("div",{className:"flex justify-between items-end gap-12 font-sans",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase mb-3 tracking-widest",children:"Digital Signature of Applicant"}),e.jsx("div",{className:`h-24 border-b-2 flex items-center justify-center pb-2 px-6 ${c||u?"border-slate-900":"border-red-400 bg-red-50"}`,children:c?e.jsx("img",{src:c,alt:"Signature",className:"h-20 object-contain"}):u?e.jsxs("span",{className:"font-serif italic text-4xl text-slate-900",children:["/s/ ",u]}):e.jsxs("div",{className:"text-center",children:[e.jsx(AlertCircle,{size:24,className:"mx-auto text-red-500 mb-2"}),e.jsx("span",{className:"text-red-500 text-xs font-bold block uppercase tracking-tighter",children:"DRIVER SIGNATURE MISSING"}),e.jsx("span",{className:"text-[10px] text-red-400",children:"Application must be signed before transmission"})]})}),e.jsxs("p",{className:"text-[9px] text-slate-400 mt-3 uppercase tracking-tighter",children:["Attested to under penalty of perjury • IP: ",n.ipAddress||"Verified"]})]}),e.jsxs("div",{className:"w-56",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-500 uppercase mb-3 tracking-widest text-right",children:"Date of Authorization"}),e.jsx("div",{className:"h-24 border-b-2 border-slate-900 flex items-center justify-end pb-2",children:e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-2xl font-bold text-slate-900",children:n["signature-date"]||new Date().toLocaleDateString()}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1 uppercase",children:"Valid for 30 Days"})]})})]})]})]}),e.jsxs("div",{className:"opacity-80 pointer-events-none grayscale border-t-2 border-dashed border-slate-300 pt-8 mt-12 bg-slate-50/20 p-8 rounded-xl",children:[e.jsx("h4",{className:"text-[11px] font-black uppercase text-slate-800 mb-8 tracking-widest text-center border-b border-slate-200 pb-2",children:"Employment History Questionnaire (To be completed by Recipient)"}),e.jsxs("div",{className:"space-y-8 font-sans",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-12 gap-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-xs font-bold text-slate-700",children:"Did this person work for you?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 border border-slate-400 rounded-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:"YES"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 border border-slate-400 rounded-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:"NO"})]})]})]}),e.jsxs("div",{className:"flex flex-col border-b border-slate-200 pb-2",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("span",{className:"text-xs font-bold text-slate-700",children:"Dates of employment correct?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 border border-slate-400 rounded-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:"YES"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 border border-slate-400 rounded-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:"NO"})]})]})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsx("span",{className:"text-[9px] uppercase text-slate-400 font-bold whitespace-nowrap",children:"If no, explain:"}),e.jsx("div",{className:"flex-1 border-b border-slate-300 h-4"})]})]}),e.jsxs("div",{className:"col-span-1 flex flex-col border-b border-slate-200 pb-2",children:[e.jsx("span",{className:"text-xs font-bold text-slate-700",children:"Type of equipment operated:"}),e.jsx("div",{className:"mt-2 flex-1 border-b border-slate-300 h-5"})]}),e.jsxs("div",{className:"flex flex-col border-b border-slate-200 pb-2",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("span",{className:"text-xs font-bold text-slate-700",children:"Eligible for re-hire?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 border border-slate-400 rounded-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:"YES"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 border border-slate-400 rounded-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:"NO"})]})]})]}),e.jsxs("div",{className:"mt-2 flex items-end gap-2",children:[e.jsx("span",{className:"text-[9px] uppercase text-slate-400 font-bold whitespace-nowrap",children:"If no, explain:"}),e.jsx("div",{className:"flex-1 border-b border-slate-300 h-4"})]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-slate-200",children:[e.jsx("h5",{className:"text-[10px] font-black uppercase text-slate-500 mb-4 tracking-widest",children:"Safety Performance (Accidents)"}),e.jsxs("div",{className:"flex flex-col border-b border-slate-200 pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("span",{className:"text-xs font-bold text-slate-700",children:"Did the driver have any DOT-recordable accidents?"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 border border-slate-400 rounded-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:"YES"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 border border-slate-400 rounded-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:"NO"})]})]})]}),e.jsxs("div",{className:"mt-3 flex items-end gap-2",children:[e.jsx("span",{className:"text-[9px] uppercase text-slate-400 font-bold whitespace-nowrap",children:"If yes, please provide dates and details:"}),e.jsx("div",{className:"flex-1 border-b border-slate-300 h-4"})]}),e.jsx("div",{className:"mt-4 border-b border-slate-300 h-4"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-slate-200",children:[e.jsx("h5",{className:"text-[10px] font-black uppercase text-slate-500 mb-4 tracking-widest",children:"Drug & Alcohol Compliance (Part 40)"}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:["Did the driver refuse to take a required drug or alcohol test?","Did the driver have any other drug/alcohol regulation violations?","Did the driver test positive for a controlled substance?"].map((p,f)=>e.jsxs("div",{className:"flex flex-col border-b border-slate-100 pb-3",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("span",{className:"text-xs font-bold text-slate-700",children:p}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 border border-slate-400 rounded-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:"YES"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-4 h-4 border border-slate-400 rounded-sm"}),e.jsx("span",{className:"text-[10px] font-bold text-slate-400",children:"NO"})]})]})]}),e.jsxs("div",{className:"mt-3 flex items-end gap-2",children:[e.jsx("span",{className:"text-[9px] uppercase text-slate-400 font-bold whitespace-nowrap",children:"If yes, explain:"}),e.jsx("div",{className:"flex-1 border-b border-slate-300 h-4"})]})]},f))})]})]})]}),e.jsx("div",{className:"mt-20 border-t border-slate-200 pt-4 text-center",children:e.jsxs("p",{className:"text-[8px] text-slate-400 font-sans uppercase tracking-[0.2em]",children:["Protected by SafeHaul Encryption Services • Secure Audit ID: ",Math.random().toString(36).substring(2,15).toUpperCase()]})})]})}),e.jsxs("div",{className:"p-6 bg-white border-t border-gray-200 flex justify-end gap-3 px-12",children:[e.jsx("button",{onClick:m,className:"px-8 py-3 text-slate-600 font-bold hover:bg-slate-100 rounded-xl transition-all",children:"Edit Request"}),e.jsxs("button",{onClick:()=>{if(!c&&!u)return alert("DOCUMENT REJECTED: This form cannot be transmitted without a valid applicant signature. Please ensure the driver has signed the application.");N()},className:`px-10 py-3 text-white font-black rounded-xl shadow-xl flex items-center gap-3 transition-all transform hover:scale-[1.02] active:scale-[0.98] ${!c&&!u?"bg-slate-400 cursor-not-allowed grayscale":"bg-blue-600 hover:bg-blue-700 shadow-blue-200"}`,disabled:!c&&!u,children:[e.jsx(Q,{size:20})," Transmit Request Now"]})]})]})})}function cs({companyId:l,applicationId:n,appData:m}){const{showSuccess:N,showError:c}=ke(),[u,p]=d.useState(null),[f,y]=d.useState(!1),[h,C]=d.useState(!1),[w,E]=d.useState(()=>{const o={};return(m?.employers||[]).forEach((g,t)=>{o[t]={status:"Not Started",lastAction:null}}),o}),i=d.useMemo(()=>m?.employers||[],[m]),r=d.useMemo(()=>{const o=i.length,g=Object.values(w).filter(x=>x.status==="Completed").length,t=Object.values(w).filter(x=>["Sent","Requested"].includes(x.status)).length;return{total:o,completed:g,pending:t}},[i,w]),s=(o,g)=>{p({...o,index:g}),y(!0)},S=(o,g)=>{y(!1),p(t=>({...t,deliveryMethod:o,contactInfo:g})),C(!0)},D=async()=>{try{const o=u,g=o.deliveryMethod==="email"?"Email":o.deliveryMethod==="fax"?"Fax":"Manual",t=o.contactInfo?.email||o.contactInfo?.fax||"Manual Download";await X(l,"applications",n,"PEV_REQUEST",`Initiated ${g} verification for ${k(o.name)} (Sent to: ${t})`,"pev"),E(x=>({...x,[o.index]:{status:"Sent",lastAction:new Date().toISOString(),method:g,recipient:t}})),N(`Verification request sent to ${k(o.name)} via ${g} (${t})`),C(!1),p(null)}catch(o){console.error("PEV Send Error:",o),c("Failed to initiate verification.")}},v=o=>{switch(o){case"Completed":return"bg-emerald-100 text-emerald-700 border-emerald-200";case"Sent":case"Requested":return"bg-blue-100 text-blue-700 border-blue-200";case"Discrepancy":return"bg-red-100 text-red-700 border-red-200";default:return"bg-slate-100 text-slate-600 border-slate-200"}},A=({status:o})=>{switch(o){case"Completed":return e.jsx(K,{size:14});case"Sent":case"Requested":return e.jsx(ee,{size:14,className:"animate-pulse"});case"Discrepancy":return e.jsx(ae,{size:14});default:return e.jsx(Te,{size:14})}};return e.jsxs("div",{className:"space-y-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-slate-200 shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 text-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(Z,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Total Employers"}),e.jsx("p",{className:"text-2xl font-black text-slate-900",children:r.total})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-slate-200 shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-emerald-50 text-emerald-600 rounded-xl flex items-center justify-center",children:e.jsx(K,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Completed"}),e.jsx("p",{className:"text-2xl font-black text-slate-900",children:r.completed})]})]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-slate-200 shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-amber-50 text-amber-600 rounded-xl flex items-center justify-center",children:e.jsx(P,{size:24})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest",children:"Compliance Status"}),e.jsx("p",{className:"text-sm font-bold text-amber-700",children:"Audit in Progress"})]})]})]}),e.jsx(O,{title:"Verification Center (DOT Compliance)",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-slate-50 border border-slate-100 rounded-lg text-xs font-medium text-slate-500",children:[e.jsx(de,{size:14,className:"text-blue-500"}),"FMCSA 391.23(a)(2) requires investigation of employment history for the previous 3 years from the date of the application."]}),i.length===0?e.jsxs("div",{className:"p-12 text-center bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200",children:[e.jsx(Z,{size:40,className:"mx-auto text-slate-200 mb-3"}),e.jsx("p",{className:"text-slate-400 italic",children:"No historical employers detected in this application."})]}):e.jsx("div",{className:"grid gap-4",children:i.map((o,g)=>{const t=w[g]||{status:"Not Started"};return e.jsxs("div",{className:"group bg-white border border-slate-200 rounded-2xl p-5 hover:border-blue-300 hover:shadow-md transition-all relative overflow-hidden",children:[e.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${t.status==="Completed"?"bg-emerald-500":t.status==="Sent"?"bg-blue-500":"bg-slate-200"}`}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center shrink-0 transition-colors ${t.status==="Completed"?"bg-emerald-50 text-emerald-600":"bg-slate-100 text-slate-500 group-hover:bg-blue-50 group-hover:text-blue-600"}`,children:e.jsx(Z,{size:24})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-bold text-slate-900 leading-tight",children:k(o.name)}),e.jsxs("span",{className:`flex items-center gap-1 px-2 py-0.5 rounded-full text-[10px] font-black uppercase tracking-wider border ${v(t.status)}`,children:[e.jsx(A,{status:t.status}),t.status]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 mt-1",children:[e.jsxs("span",{className:"text-xs font-medium text-slate-500 flex items-center gap-1",children:[e.jsx(ee,{size:12})," ",k(o.dates)]}),e.jsxs("span",{className:"text-xs font-medium text-slate-500",children:[k(o.city),", ",k(o.state)]}),t.method&&e.jsxs("span",{className:"text-xs font-bold text-blue-600 flex items-center gap-1",children:[e.jsx(le,{size:12})," Sent via ",t.method]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t.status==="Not Started"?e.jsxs("button",{onClick:()=>s(o,g),className:"px-4 py-2 bg-blue-600 text-white text-xs font-bold rounded-xl hover:bg-blue-700 shadow-lg shadow-blue-100 transition-all flex items-center gap-2 active:scale-95",children:[e.jsx(P,{size:14})," Initiate PEV"]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"px-4 py-2 bg-white border border-slate-200 text-slate-700 text-xs font-bold rounded-xl hover:bg-slate-50 transition-all flex items-center gap-2",children:[e.jsx($,{size:14})," View History"]}),e.jsx("button",{onClick:()=>s(o,g),className:"p-2 bg-slate-100 text-slate-400 rounded-xl hover:text-blue-600 hover:bg-blue-50 transition-all",title:"Resend Request",children:e.jsx(fe,{size:16})})]})})]})]},g)})})]})}),f&&u&&e.jsx(Me,{employer:u,applicant:m,onClose:()=>{y(!1),p(null)},onProceed:S}),h&&u&&e.jsx($e,{employer:u,applicant:m,onClose:()=>{C(!1),y(!0)},onSend:D})]})}export{is as ActivityHistoryTab,ns as DQFileTab,ds as GeneralDocumentsTab,os as NotesTab,cs as PEVTab};
