import{c as D,r as x,q as A,b as C,d as g,n as S,g as k,H as y,p as u,j as e,$ as j,Q as z,L as N,D as O,a0 as R,a3 as I,ae as L,f as E,W as P,k as T,E as _,s as B}from"./index-DL8sidqm.js";import{B as F}from"./building-DlN8HlPJ.js";import{F as v}from"./file-text-CIYiZE-Y.js";import{D as M}from"./dollar-sign-Dv4Qb7XK.js";const $=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],G=D("gift",$);function H(t){const[d,n]=x.useState(null),[a,r]=x.useState(!0),[i,o]=x.useState(null);return x.useEffect(()=>{async function m(){if(t){r(!0);try{const c=A(C(g,"applications"),S("driverId","==",t.uid)),h=await k(c);if(h.empty){const p=u(g,"leads",t.uid),s=await y(p);s.exists()&&n({id:s.id,status:"In Pool",companyName:"SafeHaul Network",submittedAt:s.data().createdAt,type:"global_lead",...s.data()})}else{const p=h.docs.map(l=>({ref:l.ref,...l.data()}));p.sort((l,f)=>(f.createdAt?.seconds||0)-(l.createdAt?.seconds||0));const s=p[0];let b="Unknown Company";try{const l=s.ref.parent.parent?.id;if(l){const f=await y(u(g,"companies",l));f.exists()&&(b=f.data().companyName)}}catch{console.warn("Could not fetch company name")}const w={id:s.ref.id,status:s.status||"Submitted",companyName:b,companyId:s.ref.parent.parent?.id,submittedAt:s.submittedAt||s.createdAt,type:"company_application",...s};n(w),s.status==="Offer Sent"&&s.offerDetails&&o(s.offerDetails)}}catch(c){console.error("Error fetching driver status:",c)}finally{r(!1)}}}m()},[t]),{application:d,loading:a,offer:i}}function J({application:t}){if(!t)return null;const d=a=>{const r=(a||"").toLowerCase();return r.includes("offer")?"bg-green-100 text-green-800 border-green-200":r.includes("rejected")?"bg-red-100 text-red-800 border-red-200":r.includes("review")?"bg-blue-100 text-blue-800 border-blue-200":"bg-gray-100 text-gray-800 border-gray-200"},n=t.submittedAt?.seconds?new Date(t.submittedAt.seconds*1e3).toLocaleDateString():"Recently";return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center text-blue-600",children:e.jsx(F,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:t.companyName}),e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",e.jsx("span",{className:"font-mono",children:t.id.slice(0,8)})]})]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold border ${d(t.status)}`,children:t.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(j,{size:16}),e.jsxs("span",{children:["Applied: ",n]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(v,{size:16}),e.jsxs("span",{children:["Type: ",t.type==="global_lead"?"General Pool":"Direct App"]})]})]}),e.jsx("div",{className:"w-full bg-gray-100 h-2 rounded-full mt-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.status.includes("Offer")?"bg-green-500 w-full":"bg-blue-500 w-1/2"}`})}),e.jsx("p",{className:"text-xs text-gray-400 mt-2 text-right",children:"Status updated recently"})]})}function U({offer:t,onRespond:d}){const[n,a]=x.useState(!1);if(!t)return null;const r=async i=>{if(window.confirm(`Are you sure you want to ${i==="Offer Accepted"?"ACCEPT":"DECLINE"} this offer?`)){a(!0);try{await d(i)}catch(o){console.error(o),a(!1)}}};return e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-2xl p-6 shadow-sm mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-green-100 text-green-700 rounded-full",children:e.jsx(G,{size:24})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-green-900",children:"Job Offer Received!"}),e.jsx("p",{className:"text-green-700 text-sm",children:"Review the details below."})]})]}),e.jsx("div",{className:"bg-white rounded-xl p-4 border border-green-100 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-bold text-green-800 uppercase mb-1 flex items-center gap-1",children:[e.jsx(M,{size:14})," Pay Rate"]}),e.jsxs("p",{className:"text-lg font-bold text-gray-900",children:[t.payRate," ",e.jsxs("span",{className:"text-xs font-medium text-gray-500",children:["/ ",t.payType]})]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-bold text-green-800 uppercase mb-1 flex items-center gap-1",children:[e.jsx(j,{size:14})," Start Date"]}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.startDate?new Date(t.startDate).toLocaleDateString():"TBD"})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>r("Offer Declined"),disabled:n,className:"flex-1 py-3 bg-white border border-gray-300 text-gray-600 font-bold rounded-xl hover:bg-gray-50 flex items-center justify-center gap-2",children:[e.jsx(z,{size:18})," Decline"]}),e.jsxs("button",{onClick:()=>r("Offer Accepted"),disabled:n,className:"flex-[2] py-3 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 shadow-md flex items-center justify-center gap-2",children:[n?e.jsx(N,{className:"animate-spin",size:18}):e.jsx(O,{size:18}),"Accept Offer"]})]})]})}function Y(){const{currentUser:t,handleLogout:d}=R(),n=I(),{application:a,loading:r,offer:i}=H(t),o=async m=>{if(!(!a||!a.companyId))try{const c=u(g,"companies",a.companyId,"applications",a.id);await _(c,{status:m,"offerDetails.response":m,"offerDetails.respondedAt":new Date().toISOString(),updatedAt:B()}),window.location.reload()}catch(c){console.error("Error updating offer:",c),alert("Failed to update offer status. Please try again.")}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center sticky top-0 z-10 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center text-white shadow-md",children:e.jsx(L,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-gray-900 leading-tight",children:"Driver Portal"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Welcome, ",t?.email]})]})]}),e.jsx("button",{onClick:d,className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"Sign Out",children:e.jsx(E,{size:20})})]}),e.jsxs("div",{className:"max-w-md mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-gray-400",children:e.jsx(P,{size:32})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"My Profile"}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 border border-green-200",children:"Active Account"})]})]}),r?e.jsxs("div",{className:"py-12 text-center text-gray-400 flex flex-col items-center",children:[e.jsx(N,{className:"animate-spin mb-3 text-indigo-600",size:32}),e.jsx("p",{children:"Checking application status..."})]}):e.jsxs(e.Fragment,{children:[i&&!i.response&&e.jsx(U,{offer:i,onRespond:o}),a?e.jsx(J,{application:a}):e.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl p-6 shadow-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-50 text-blue-600 rounded-xl",children:e.jsx(v,{size:24})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Job Application"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"You haven't submitted an application yet. Complete your profile to get started."}),e.jsxs("button",{onClick:()=>n("/driver/apply"),className:"mt-5 w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition-all shadow-md flex items-center justify-center gap-2",children:["Start Application",e.jsx(T,{size:18})]})]})]})})]})]})]})}export{Y as DriverDashboard};
