import{c as I,C as i,A as L,P as N,d as M,a as T,x as w,o as U,D as e,X as F,a3 as B,L as D,E as X,G as E,S as G,a4 as q,a5 as V,a6 as C,a7 as S,a8 as Y,M as _,a9 as H}from"./index-Eut2KIY5.js";import{f as A,a as k,g as P,b as W,r as z}from"./driverService-BuYSst19.js";import{i as $,c as K,a as Q,g as Z}from"./signature-CKsXCBTr.js";import{c as ee}from"./confetti.module-oQXWb4Lk.js";import{F as se}from"./file-pen-line-CZApjMvZ.js";import{D as te}from"./dollar-sign-DE8xXdSp.js";import{P as re}from"./pen-tool-CnWi3ktp.js";import{F as ae}from"./file-text-fIi5thw4.js";import"./pdfjs-CN6VhWT3.js";import"./applicationId-D0tBiTrd.js";const ie=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],le=I("gift",ie);function ne(){const[m,t]=i.useState(null),[g,r]=i.useState([]),[o,l]=i.useState([]),[f,s]=i.useState([]),[p,u]=i.useState(!0),[y,b]=i.useState(!1),[a,j]=i.useState(null),h=L();return i.useEffect(()=>{const n=N.onAuthStateChanged(async c=>{if(!c){h("/login");return}j(c);try{const[x,O,J]=await Promise.all([A(c.uid),k(c.email,c.uid),P(c.uid)]);if(t(x),r(O),s(J),x&&x.driverProfile?.type){const R=await W(x.driverProfile.type);l(R)}}catch(x){console.error("Dashboard Load Error:",x)}finally{u(!1)}});return()=>n()},[h]),{currentUser:a,profile:m,applications:g,recommendedJobs:o,savedJobsData:f,loading:p,creating:y,handleCreateProfile:async()=>{if(a){b(!0);try{const n=M(T,"drivers",a.uid),c={personalInfo:{firstName:"Driver",email:a.email,city:"Update Profile",state:"XX"},qualifications:{experienceYears:"New"},licenses:[],createdAt:w(),lastUpdatedAt:w()};await U(n,c,{merge:!0});const x=await A(a.uid);t(x)}catch(n){console.error("Error creating profile:",n)}finally{b(!1)}}},onLogout:async()=>{await N.signOut(),h("/login")},refreshData:async()=>{if(a){const n=await k(a.email,a.uid);r(n)}},refreshSavedJobs:async()=>{if(a){const n=await P(a.uid);s(n)}}}}function oe({application:m,onClose:t,onUpdate:g}){const[r,o]=i.useState(!1),[l,f]=i.useState(!1),{offerDetails:s,companyName:p,companyId:u,id:y,originalId:b}=m,a=b||y;if(i.useEffect(()=>{l&&setTimeout($,100)},[l]),!s)return null;const j=async()=>{if(window.confirm("Are you sure you want to DECLINE this offer?")){o(!0);try{await z(u,a,"Offer Declined"),g(),setTimeout(t,500)}catch(d){alert("Error: "+d.message)}finally{o(!1)}}},h=async()=>{if(Q()){alert("Please sign the offer to accept.");return}if(window.confirm("Are you sure you want to ACCEPT this offer with your signature?")){o(!0);try{const d=Z();await z(u,a,"Offer Accepted",d),ee({particleCount:100,spread:70,origin:{y:.6}}),g(),setTimeout(t,1e3)}catch(d){console.error("Error responding:",d),alert("Failed to update status.")}finally{o(!1)}}};return e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-2xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"bg-blue-600 p-6 text-white text-center relative",children:[e.jsx("button",{onClick:t,className:"absolute top-4 right-4 p-1 hover:bg-white/20 rounded-full transition",children:e.jsx(F,{size:20})}),e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-3 backdrop-blur-md",children:e.jsx(se,{size:32,className:"text-white"})}),e.jsx("h2",{className:"text-2xl font-bold",children:l?"Sign & Accept":"Job Offer Received!"}),e.jsxs("p",{className:"text-blue-100 text-sm mt-1",children:[p," wants to hire you."]})]}),l?e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"p-6 flex-1 flex flex-col items-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4 text-center",children:"Please sign below to officially accept this offer."}),e.jsxs("div",{className:"w-full relative border-2 border-dashed border-gray-300 rounded-xl bg-gray-50 overflow-hidden touch-none",children:[e.jsx("canvas",{id:"signature-canvas",className:"w-full h-48 cursor-crosshair touch-none"}),e.jsx("button",{onClick:K,className:"absolute bottom-2 right-2 text-xs bg-white border border-gray-200 px-2 py-1 rounded text-red-500 hover:bg-red-50 transition",children:"Clear"})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-4 text-center px-4",children:'By clicking "Complete Acceptance", I agree that this signature is legally binding and equivalent to my handwritten signature.'})]}),e.jsxs("div",{className:"p-6 bg-gray-50 border-t border-gray-200 flex gap-3",children:[e.jsx("button",{onClick:()=>f(!1),className:"flex-1 py-3 px-4 bg-white border border-gray-300 text-gray-700 font-bold rounded-xl hover:bg-gray-50 transition",children:"Back"}),e.jsxs("button",{onClick:h,disabled:r,className:"flex-[2] py-3 px-4 bg-green-600 text-white font-bold rounded-xl hover:bg-green-700 shadow-lg transition flex items-center justify-center gap-2",children:[r?e.jsx(D,{className:"animate-spin"}):e.jsx(E,{size:20}),"Complete Acceptance"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-100 rounded-xl text-center",children:[e.jsx("p",{className:"text-xs font-bold text-green-600 uppercase mb-1",children:"Pay Rate"}),e.jsxs("div",{className:"flex items-center justify-center gap-1 text-gray-900 font-bold text-xl",children:[e.jsx(te,{size:20,className:"text-green-600"}),s.payRate," ",e.jsx("span",{className:"text-xs font-normal text-gray-500 self-end mb-1",children:s.payType})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-100 rounded-xl text-center",children:[e.jsx("p",{className:"text-xs font-bold text-blue-600 uppercase mb-1",children:"Start Date"}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-900 font-bold text-lg mt-1",children:[e.jsx(B,{size:18,className:"text-blue-600"}),s.startDate]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(le,{size:16,className:"text-purple-500"})," Benefits & Perks"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.benefits&&s.benefits.length>0?s.benefits.map((d,v)=>e.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full border border-gray-200",children:d},v)):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No specific benefits listed."})})]}),e.jsxs("div",{className:"text-center text-xs text-gray-400 pt-2",children:["Offer generated on ",new Date(s.sentAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"p-6 bg-gray-50 border-t border-gray-200 grid grid-cols-2 gap-4",children:[e.jsxs("button",{onClick:j,disabled:r,className:"py-3 px-4 bg-white border-2 border-gray-200 text-gray-600 font-bold rounded-xl hover:bg-gray-100 hover:text-gray-800 hover:border-gray-300 transition flex items-center justify-center gap-2",children:[r?e.jsx(D,{className:"animate-spin"}):e.jsx(X,{size:20}),"Decline"]}),e.jsxs("button",{onClick:()=>f(!0),disabled:r,className:"py-3 px-4 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 shadow-lg hover:shadow-xl transition flex items-center justify-center gap-2",children:[e.jsx(re,{size:20}),"Sign & Accept"]})]})]})]})})}const de=m=>{const t=(m||"").toLowerCase();return t.includes("offer")||t.includes("hired")||t.includes("approved")?"bg-green-100 text-green-800 border-green-200":t.includes("rejected")||t.includes("declined")?"bg-red-100 text-red-800 border-red-200":t.includes("new")||t.includes("submitted")?"bg-blue-100 text-blue-800 border-blue-200":"bg-gray-100 text-gray-800 border-gray-200"};function Ne(){const{handleLogout:m}=G();L();const{currentUser:t,profile:g,applications:r,loading:o,refreshData:l}=ne(),f=r.find(s=>s.status==="Offer Sent"&&(!s.offerDetails?.response||s.offerDetails.response==="Pending"));return o?e.jsx("div",{className:"min-h-screen bg-gray-50 p-6 space-y-6",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[e.jsx("div",{className:"h-20 bg-gray-200 rounded-xl animate-pulse"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded-2xl animate-pulse"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-xl animate-pulse"},s))}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 w-48 bg-gray-200 rounded animate-pulse"}),[1,2,3].map(s=>e.jsx("div",{className:"h-32 bg-gray-200 rounded-xl animate-pulse"},s))]})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50 font-sans pb-10",children:[f&&e.jsx(oe,{application:f,onClose:()=>l(),onUpdate:l}),e.jsx("header",{className:"bg-white border-b border-gray-200 sticky top-0 z-20 px-6 py-4 shadow-sm",children:e.jsxs("div",{className:"max-w-5xl mx-auto flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white shadow-blue-200 shadow-md",children:e.jsx(q,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-bold text-gray-900 leading-tight",children:"Driver Portal"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Welcome back, ",g?.personalInfo?.firstName||t?.email]})]})]}),e.jsx("button",{onClick:m,className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-full transition-colors",title:"Sign Out",children:e.jsx(V,{size:20})})]})}),e.jsxs("main",{className:"max-w-5xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200 flex flex-col sm:flex-row items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 bg-green-50 rounded-full flex items-center justify-center text-green-600 border border-green-100",children:e.jsx(E,{size:28})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Master Profile"}),e.jsx("p",{className:"text-sm text-gray-500",children:g?"Your profile is active and ready for applications.":"Complete your profile to apply faster."})]})]}),e.jsxs(C,{to:"/driver/profile",className:"px-6 py-3 bg-white border border-gray-300 text-gray-700 font-bold rounded-xl hover:bg-gray-50 hover:border-gray-400 transition-all shadow-sm flex items-center gap-2",children:["Edit Profile ",e.jsx(S,{size:16})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase",children:"Applications"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r.length})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase",children:"Active Offers"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.filter(s=>s.status==="Offer Sent").length})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ae,{size:20,className:"text-blue-600"})," My Applications"]}),r.length===0?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-10 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Y,{size:32})}),e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:"No applications yet"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Start applying to jobs to see your status here."}),e.jsx(C,{to:"/driver/apply",className:"inline-flex items-center gap-2 px-6 py-3 bg-blue-600 text-white font-bold rounded-xl hover:bg-blue-700 transition-all shadow-md",children:"Start New Application"})]}):e.jsx("div",{className:"space-y-4",children:r.map(s=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-md transition-shadow flex flex-col sm:flex-row justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:s.companyName||"General Application"}),e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-bold uppercase border ${de(s.status)}`,children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{size:14})," ",s.submittedAt?new Date(s.submittedAt.seconds*1e3).toLocaleDateString():"Draft"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(H,{size:14})," ",s.city||"Remote",", ",s.state||"US"]})]})]}),e.jsx("div",{className:"flex items-center",children:s.status==="Offer Sent"?e.jsx("button",{onClick:()=>l(),className:"px-5 py-2 bg-green-600 text-white font-bold rounded-lg hover:bg-green-700 transition-colors shadow-sm animate-pulse",children:"View Offer"}):e.jsxs("div",{className:"text-sm text-gray-400 font-medium flex items-center gap-1",children:[s.status==="New Application"?"In Review":"View Details"," ",e.jsx(S,{size:16})]})})]},s.id))})]})]})]})}export{Ne as DriverDashboard};
