import{c as b,P as h,f,a as m,ae as U,x as p,q as D,af as E,w as V,aa as X,ag as O,d as A,v as T,D as e,X as W,G as C,L as S,a0 as H}from"./index-Eut2KIY5.js";import{C as Q,L as Z}from"./shield-alert-CyrU0uX3.js";import{U as z}from"./upload-CeDmLZPo.js";import{F as J}from"./useBulkImport-DleduGt8.js";import{D as K}from"./external-link-DG7NPcwU.js";const Y=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],xe=b("award",Y);const ee=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],me=b("database",ee);const se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],ue=b("globe",se);const ae=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],re=b("rotate-ccw",ae);const te=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],he=b("wrench",te);async function be(a,s,t,r,n,l="user"){try{if(!a||!t){console.error("Missing companyId or docId for activity log");return}let i="System",o="system";h.currentUser&&(o=h.currentUser.uid,h.currentUser.displayName?i=h.currentUser.displayName:i=h.currentUser.email);const x=f(m,"companies",a,s==="leads"||s==="companies"||s==="company_leads"||s==="my_leads"?"leads":"applications",t,"activity_logs");await U(x,{action:r,details:n,type:l,companyId:a,performedBy:o,performedByName:i,timestamp:p()})}catch(i){console.error("Failed to log activity:",i)}}async function pe({recipientId:a,title:s,message:t,type:r="info",link:n=null,scheduledFor:l=null,metadata:i={}}){if(a)try{await U(f(m,"notifications"),{recipientId:a,title:s,message:t,type:r,link:n,scheduledFor:l?l.toISOString():null,metadata:i,isRead:!1,status:"new",createdAt:p()})}catch(o){console.error("Error sending notification:",o)}}function ge(a,s){if(!a)return()=>{};const t=D(f(m,"notifications"),V("recipientId","==",a),E("createdAt","desc"));return X(t,r=>{const n=r.docs.map(l=>({id:l.id,...l.data()})).filter(l=>l.status!=="dismissed");s(n)})}async function le(a,s){if(!a||!s)return;const t=A(m,"notifications",a),r={status:s};(s==="read"||s==="completed"||s==="dismissed")&&(r.isRead=!0),s==="completed"&&(r.completedAt=p()),s==="dismissed"&&(r.dismissedAt=p()),await T(t,r)}async function fe(a){await le(a,"read")}async function ye(a){if(!a||a.length===0)return;const s=a.filter(r=>!r.isRead);if(s.length===0)return;const t=500;for(let r=0;r<s.length;r+=t){const n=s.slice(r,r+t),l=O(m);n.forEach(i=>{const o=A(m,"notifications",i.id);l.update(o,{isRead:!0,status:"read"})}),await l.commit()}}function je({title:a="Bulk Upload",step:s,importMethod:t,setImportMethod:r,sheetUrl:n,setSheetUrl:l,processingSheet:i,handleSheetImport:o,handleFileChange:y,csvData:x,reset:_,onConfirm:R,onClose:j,uploading:N,progress:L,stats:v,children:B,headerAction:$,onDownloadTemplate:w,instructions:k}){const g=[{id:"upload",label:"Upload"},{id:"preview",label:"Preview"},{id:"success",label:"Finish"}],u=g.findIndex(c=>c.id===s),F=()=>e.jsx("div",{className:"flex items-center justify-center mb-6",children:g.map((c,d)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center gap-2 ${d<=u?"text-blue-600":"text-gray-400"}`,children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold border-2 ${d<u?"bg-blue-600 text-white border-blue-600":d===u?"bg-white text-blue-600 border-blue-600":"bg-white text-gray-400 border-gray-200"}`,children:d<u?e.jsx(C,{size:14}):d+1}),e.jsx("span",{className:"text-sm font-medium",children:c.label})]}),d<g.length-1&&e.jsx("div",{className:`w-8 h-0.5 mx-2 ${d<u?"bg-blue-600":"bg-gray-200"}`})]},c.id))}),M=()=>e.jsxs("div",{className:"space-y-6",children:[k&&e.jsxs("div",{className:"bg-blue-50 border border-blue-100 rounded-lg p-4 text-sm text-blue-800 flex items-start gap-3",children:[e.jsx(Q,{size:18,className:"shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold mb-1",children:"Instructions"}),e.jsx("div",{className:"opacity-90 leading-relaxed whitespace-pre-line",children:k})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>r("file"),className:`p-4 border-2 rounded-xl transition-all ${t==="file"?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(z,{className:"mx-auto mb-2",size:24}),e.jsx("span",{className:"font-medium",children:"Upload File"})]}),e.jsxs("button",{onClick:()=>r("gsheet"),className:`p-4 border-2 rounded-xl transition-all ${t==="gsheet"?"border-green-500 bg-green-50 text-green-700":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx(J,{className:"mx-auto mb-2",size:24}),e.jsx("span",{className:"font-medium",children:"Google Sheet"})]})]}),w&&e.jsx("div",{className:"flex justify-end mb-2",children:e.jsxs("button",{onClick:w,className:"text-xs font-bold text-blue-600 hover:text-blue-800 flex items-center gap-1 hover:underline",children:[e.jsx(K,{size:14})," Download CSV Template"]})}),t==="file"&&e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-blue-400 transition-colors",children:[e.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:y,className:"hidden",id:"file-upload"}),e.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer",children:[e.jsx(z,{className:"mx-auto mb-4 text-gray-400",size:40}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"CSV, XLS, or XLSX files"})]})]}),t==="gsheet"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",value:n,onChange:c=>l(c.target.value),placeholder:"Paste Google Sheet URL...",className:"flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"}),e.jsxs("button",{onClick:o,disabled:!n||i,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[i?e.jsx(S,{className:"animate-spin",size:18}):e.jsx(Z,{size:18}),"Import"]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Make sure the sheet is publicly accessible or shared with view permissions."})]})]}),P=()=>e.jsxs("div",{className:"space-y-4",children:[B,e.jsxs("div",{className:"bg-gray-50 rounded-xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"p-3 bg-gray-100 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:["Preview (",x?.length||0," records)"]}),e.jsxs("button",{onClick:_,className:"text-sm text-gray-500 hover:text-gray-700 flex items-center gap-1",children:[e.jsx(re,{size:14})," Reset"]})]}),e.jsx("div",{className:"max-h-64 overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsx("tr",{children:x?.[0]&&Object.keys(x[0]).slice(0,5).map(c=>e.jsx("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:c},c))})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:x?.slice(0,10).map((c,d)=>e.jsx("tr",{className:"hover:bg-gray-50",children:Object.values(c).slice(0,5).map((I,q)=>e.jsx("td",{className:"px-3 py-2 text-gray-700 truncate max-w-[150px]",children:String(I||"")},q))},d))})]})})]}),e.jsx("button",{onClick:R,disabled:N,className:"w-full py-3 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:N?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"animate-spin",size:20}),L||"Processing..."]}):e.jsxs(e.Fragment,{children:["Confirm Upload ",e.jsx(H,{size:18})]})})]}),G=()=>e.jsxs("div",{className:"text-center py-8",children:[e.jsx(C,{className:"mx-auto mb-4 text-green-500",size:64}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Upload Complete!"}),e.jsxs("div",{className:"flex justify-center gap-6 text-sm text-gray-600 mb-6",children:[e.jsxs("span",{children:[e.jsx("strong",{className:"text-green-600",children:v?.created||0})," Created"]}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-blue-600",children:v?.updated||0})," Updated"]})]}),e.jsx("button",{onClick:j,className:"px-6 py-2 bg-gray-100 text-gray-700 font-medium rounded-lg hover:bg-gray-200",children:"Close"})]});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl border border-gray-200",children:[e.jsxs("div",{className:"p-5 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:a}),e.jsxs("div",{className:"flex items-center gap-3",children:[$,e.jsx("button",{onClick:j,className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(W,{size:20})})]})]}),e.jsxs("div",{className:"p-6",children:[F(),s==="upload"&&M(),s==="preview"&&P(),s==="success"&&G()]})]})})}export{xe as A,je as B,me as D,ue as G,re as R,he as W,fe as a,pe as b,be as l,ye as m,ge as s,le as u};
