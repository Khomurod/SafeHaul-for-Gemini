import{c as H,r as i,q as W,a as V,d as U,l as oe,g as Q,b as ie,o as ve,e as pe,j as e,U as ce,B as Ke,S as le,X as de,L as G,Z as fe,f as Xe,h as R,i as $e,C as Re,k as Fe,m as _e,w as Se,n as ke,p as q,s as Y,t as Je,u as es,v as Be,x as te,y as ae,z as Pe,A as ze,D as qe,E as he,F as ue,G as Te,H as De,I as ss,J as ye,K as ts,M as as,N as rs,O as ls,P as ns,Q as os,T as Le,R as is,V as cs,W as Oe,Y as ds,_ as ms,$ as xs,a0 as ps}from"./index-DL8sidqm.js";import{l as us,P as be}from"./userService-CF_Ufzlf.js";import{B as je}from"./building-DlN8HlPJ.js";import{F as re}from"./file-text-CIYiZE-Y.js";import{D as Ge,u as gs,B as hs,a as ys,l as bs,A as fs}from"./ApplicationDetailView-BbGvLvgh.js";import{P as He,C as js}from"./plus-7Y37wSRt.js";import{T as me,S as Ns}from"./trash-2-wanxsFLc.js";import{S as ws}from"./upload-CA7-GPEs.js";import{u as Ve,E as vs}from"./EditUserModal-DTQLbi1n.js";import"./dollar-sign-Dv4Qb7XK.js";import"./save-BKvBBKs-.js";const Cs=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Ae=H("activity",Cs);const Ss=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],ks=H("arrow-up-right",Ss);const Ds=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],Qe=H("chart-column",Ds);const As=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],Ps=H("crown",As);const Ls=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ze=H("layers",Ls);const Is=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],zs=H("layout-dashboard",Is);const Ts=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],Es=H("lock-open",Ts);const Us=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],Ms=H("play",Us);const $s=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],Rs=H("share-2",$s);const Fs=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],_s=H("terminal",Fs);const Bs=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],We=H("trending-up",Bs);function qs(){const[a,o]=i.useState([]),[s,t]=i.useState([]),[c,u]=i.useState([]),[l,m]=i.useState(new Map),[p,x]=i.useState(!0),[d,k]=i.useState({companies:!1,users:!1,apps:!1}),[r,w]=i.useState({companyCount:0,userCount:0,appCount:0}),[j,n]=i.useState(""),f=async()=>{x(!0),k({companies:!1,users:!1,apps:!1});const S=async()=>{try{const C=[],A=new Map;A.set("general-leads","SafeHaul Pool (Unassigned)");const z=W(V(U,"companies"),oe(500));return(await Q(z)).forEach(F=>{C.push({id:F.id,...F.data()}),A.set(F.id,F.data().companyName)}),{companies:C,compMap:A}}catch(C){return console.error("Error loading companies:",C),k(A=>({...A,companies:!0})),{companies:[],compMap:new Map}}},N=async()=>{try{const C=W(V(U,"users"),oe(500)),[A,z]=await Promise.all([Q(C),us()]),L=new Map;return z.forEach(E=>{const I=E.data();L.has(I.userId)||L.set(I.userId,[]),L.get(I.userId).push(I)}),A.docs.map(E=>({id:E.id,...E.data(),memberships:L.get(E.id)||[]}))}catch(C){return console.error("Error loading users:",C),k(A=>({...A,users:!0})),[]}},T=async()=>{try{const z=W(ie(U,"applications"),ve("createdAt","desc"),oe(150)),L=W(ie(U,"leads"),ve("createdAt","desc"),oe(150)),F=W(V(U,"drivers"),ve("createdAt","desc"),oe(200)),[E,I,K]=await Promise.all([Q(z),Q(L),Q(F)]),X=E.docs.map(M=>{const O=M.data(),J=M.ref.parent.parent,ee=J?J.id:O.companyId;return{id:M.id,...O,companyId:ee,sourceType:"Company App",status:O.status||"New Application"}}),ne=I.docs.map(M=>{const O=M.data(),ee=M.ref.parent.parent;if(ee){const $=O.isPlatformLead===!0;return{id:M.id,...O,companyId:ee.id,status:O.status||"New Lead",sourceType:$?"Distributed Lead":"Company Import"}}else return{id:M.id,...O,companyId:"general-leads",status:O.status||"New Lead",sourceType:"Global Pool"}}),Ne=new Set([...X,...ne].map(M=>M.id)),we=K.docs.map(M=>({id:M.id,...M.data()})).filter(M=>M.driverProfile?.isBulkUpload).filter(M=>!Ne.has(M.id)).map(M=>({id:M.id,...M.personalInfo,companyId:"general-leads",status:"Bulk Lead",sourceType:"Global Pool",createdAt:M.createdAt})),xe=[...X,...ne,...we];return xe.sort((M,O)=>{const J=M.createdAt?.seconds||0;return(O.createdAt?.seconds||0)-J}),xe}catch(C){return console.error("Error loading apps/leads:",C),k(A=>({...A,apps:!0})),[]}},g=async()=>{try{const C=await pe(V(U,"companies")),A=await pe(V(U,"users")),z=await pe(ie(U,"leads")),L=await pe(ie(U,"applications"));return{companyCount:C.data().count,userCount:A.data().count,appCount:z.data().count+L.data().count}}catch(C){return console.error("Error fetching counts:",C),null}},[b,P,v,h]=await Promise.all([S(),N(),T(),g()]);o(b.companies),m(b.compMap),t(P),u(v),w(h||{companyCount:b.companies.length,userCount:P.length,appCount:v.length}),x(!1)};i.useEffect(()=>{f()},[]);const D=i.useMemo(()=>{const S=j.toLowerCase().trim();if(!S)return{companies:[],users:[],applications:[]};const N=a.filter(b=>b.companyName?.toLowerCase().includes(S)||b.appSlug?.toLowerCase().includes(S)),T=s.filter(b=>b.name?.toLowerCase().includes(S)||b.email?.toLowerCase().includes(S)),g=c.filter(b=>{const P=`${b.firstName||""} ${b.lastName||""}`.toLowerCase(),v=(b.email||"").toLowerCase(),h=(b.cdlNumber||"").toLowerCase(),C=(b.phone||"").toLowerCase();return P.includes(S)||v.includes(S)||h.includes(S)||C.includes(S)});return{companies:N,users:T,applications:g}},[j,a,s,c]),y=D.companies.length+D.users.length+D.applications.length;return{companyList:a,userList:s,allApplications:c,allCompaniesMap:l,stats:r,loading:p,statsError:d,searchQuery:j,setSearchQuery:n,searchResults:D,totalSearchResults:y,refreshData:f}}function Z({label:a,icon:o,isActive:s,onClick:t}){return e.jsxs("button",{onClick:t,className:`
        flex items-center gap-3 w-full px-4 py-3 rounded-lg text-left font-medium
        ${s?"bg-blue-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}
        transition-all
      `,children:[o,a]})}function Os({activeView:a,setActiveView:o,isSearching:s,onClearSearch:t}){const c=u=>{o(u),t&&t()};return e.jsxs("nav",{className:"w-full sm:w-64 shrink-0 bg-white p-4 rounded-xl shadow-lg border border-gray-200 space-y-2 sticky top-24 max-h-[calc(100vh-8rem)] overflow-y-auto custom-scrollbar",children:[e.jsx(Z,{label:"Dashboard",icon:e.jsx(zs,{size:20}),isActive:a==="dashboard"&&!s,onClick:()=>c("dashboard")}),e.jsx(Z,{label:"Analytics",icon:e.jsx(Qe,{size:20}),isActive:a==="analytics"&&!s,onClick:()=>c("analytics")}),e.jsx("div",{className:"my-2 border-t border-gray-100"}),e.jsx(Z,{label:"Companies",icon:e.jsx(je,{size:20}),isActive:a==="companies"&&!s,onClick:()=>c("companies")}),e.jsx(Z,{label:"Users",icon:e.jsx(ce,{size:20}),isActive:a==="users"&&!s,onClick:()=>c("users")}),e.jsx(Z,{label:"Unified Driver DB",icon:e.jsx(re,{size:20}),isActive:a==="applications"&&!s,onClick:()=>c("applications")}),e.jsx("div",{className:"my-2 border-t border-gray-100"}),e.jsx(Z,{label:"Global Features",icon:e.jsx(Ze,{size:20}),isActive:a==="features"&&!s,onClick:()=>c("features")}),e.jsx(Z,{label:"System Health",icon:e.jsx(Ae,{size:20}),isActive:a==="system-health"&&!s,onClick:()=>c("system-health")}),e.jsx(Z,{label:"Bulk Lead Adding",icon:e.jsx(Ge,{size:20}),isActive:a==="bulk-lead-adding"&&!s,onClick:()=>c("bulk-lead-adding")}),e.jsx(Z,{label:"Create New",icon:e.jsx(He,{size:20}),isActive:a==="create"&&!s,onClick:()=>c("create")})]})}function Gs({searchQuery:a,setSearchQuery:o,onDistribute:s,distributing:t,onFixData:c,fixingData:u,onCleanup:l,cleaning:m,onLogout:p}){return e.jsx("header",{className:"sticky top-0 z-10 bg-white shadow-md border-b border-gray-200",children:e.jsxs("div",{className:"container mx-auto p-4 flex justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-600 rounded-lg text-white",children:e.jsx(Ke,{size:24})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Super Admin"})]}),e.jsxs("div",{className:"relative flex-1 max-w-xl",children:[e.jsx("input",{type:"text",placeholder:"Global Search...",className:"w-full p-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all",value:a,onChange:x=>o(x.target.value)}),e.jsx(le,{size:20,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),a&&e.jsx("button",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",onClick:()=>o(""),children:e.jsx(de,{size:20})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:l,disabled:m,className:`flex items-center gap-2 px-4 py-2 text-white text-sm font-bold rounded-lg shadow-sm transition-colors ${m?"bg-red-300 cursor-not-allowed":"bg-red-600 hover:bg-red-700"}`,title:"Delete 'Unknown Driver' and placeholder records",children:[m?e.jsx(G,{size:16,className:"animate-spin"}):e.jsx(me,{size:16}),m?"Purging...":"Purge Trash"]}),e.jsxs("button",{onClick:c,disabled:u,className:`flex items-center gap-2 px-4 py-2 text-white text-sm font-bold rounded-lg shadow-sm transition-colors ${u?"bg-gray-400 cursor-not-allowed":"bg-gray-700 hover:bg-gray-800"}`,title:"Migrate Drivers to Leads",children:[u?e.jsx(G,{size:16,className:"animate-spin"}):e.jsx(Ge,{size:16,className:"text-yellow-400"}),u?"Migrating...":"Fix Data"]}),e.jsxs("button",{onClick:s,disabled:t,className:`flex items-center gap-2 px-4 py-2 text-white text-sm font-bold rounded-lg shadow-sm transition-colors ${t?"bg-purple-400 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"}`,children:[t?e.jsx(G,{size:16,className:"animate-spin"}):e.jsx(fe,{size:16}),t?"Distributing...":"Distribute Leads"]})]}),e.jsxs("button",{id:"logout-button-super",className:"px-3 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-all flex items-center gap-2 ml-2",onClick:p,children:[e.jsx(Xe,{size:18}),e.jsx("span",{className:"hidden sm:inline",children:"Logout"})]})]})})}function Hs({results:a,totalResults:o,allCompaniesMap:s,onViewApps:t,onEditCompany:c,onEditUser:u,onAppClick:l}){const{companies:m,users:p,applications:x}=a;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:["Search Results ",e.jsxs("span",{className:"text-gray-400 font-normal",children:["(",o," found)"]})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[e.jsx(je,{size:20})," Companies (",m.length,")"]}),e.jsx("div",{className:"space-y-4",children:m.length>0?m.map(d=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-white flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"mb-3 sm:mb-0",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:R(d.companyName)}),e.jsxs("p",{className:"text-sm text-gray-600",children:["/",R(d.appSlug)]})]}),e.jsxs("div",{className:"flex gap-2 justify-end shrink-0",children:[e.jsxs("button",{onClick:()=>t({id:d.id,name:d.companyName}),className:"px-3 py-2 text-sm bg-blue-100 text-blue-700 rounded-md hover:bg-blue-200 transition-all flex items-center gap-2",children:[e.jsx(re,{size:14})," View Apps"]}),e.jsxs("button",{onClick:()=>c(d.id),className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-all flex items-center gap-2",children:[e.jsx(be,{size:14})," Edit"]})]})]},d.id)):e.jsx("p",{className:"text-gray-500 p-4 bg-white rounded-lg border",children:"No companies found."})})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[e.jsx(ce,{size:20})," Users (",p.length,")"]}),e.jsx("div",{className:"space-y-4",children:p.length>0?p.map(d=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg bg-white flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"mb-3 sm:mb-0",children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:R(d.name)}),e.jsx("p",{className:"text-sm text-gray-600",children:R(d.email)})]}),e.jsx("div",{className:"flex gap-2 justify-end shrink-0",children:e.jsxs("button",{onClick:()=>u({id:d.id}),className:"px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-all flex items-center gap-2",children:[e.jsx(be,{size:14})," Edit"]})})]},d.id)):e.jsx("p",{className:"text-gray-500 p-4 bg-white rounded-lg border",children:"No users found."})})]}),e.jsxs("section",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-700 mb-4 flex items-center gap-2",children:[e.jsx(re,{size:20})," Driver Applications (",x.length,")"]}),e.jsx("div",{className:"space-y-4",children:x.length>0?x.map(d=>e.jsxs("button",{className:"w-full p-4 border border-gray-200 rounded-lg bg-white flex flex-col sm:flex-row sm:items-center sm:justify-between text-left hover:border-blue-500 hover:shadow-md transition-all",onClick:()=>l(d),children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:`${R(d.firstName)} ${R(d.lastName)}`}),e.jsx("p",{className:"text-sm text-gray-600",children:R(d.email)}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["From: ",e.jsx("span",{className:"font-medium text-gray-700",children:s.get(d.companyId)||"Unknown Company"})]})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-semibold rounded-full ${$e(d.status||"New Application")}`,children:d.status||"New Application"})]},d.id)):e.jsx("p",{className:"text-gray-500 p-4 bg-white rounded-lg border",children:"No driver applications found."})})]})]})}function Ce({title:a,value:o,icon:s,loading:t,hasError:c}){let u=o;return t&&(u="..."),c&&(u="Error"),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200 flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-full ${c?"bg-red-100 text-red-600":"bg-blue-100 text-blue-600"}`,children:s}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:a}),e.jsx("p",{className:`text-3xl font-bold ${c?"text-red-600":"text-gray-900"} ${t?"animate-pulse":""}`,children:u})]})]})}function Vs({stats:a,statsLoading:o,statsError:s}){return e.jsxs("div",{className:"space-y-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(Ce,{title:"Total Companies",value:a.companyCount,icon:e.jsx(je,{size:24}),loading:o,hasError:s.companies}),e.jsx(Ce,{title:"Total Users",value:a.userCount,icon:e.jsx(ce,{size:24}),loading:o,hasError:s.users}),e.jsx(Ce,{title:"Total Applications",value:a.appCount,icon:e.jsx(re,{size:24}),loading:o,hasError:s.apps})]})]})}function Qs({title:a,icon:o,children:s,className:t=""}){return e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col ${t}`,children:[e.jsx("div",{className:"p-5 border-b border-gray-200 shrink-0",children:e.jsxs("h2",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[o,a]})}),s]})}function Zs({listLoading:a,statsError:o,companyList:s,onViewApps:t,onEdit:c,onDelete:u}){const[l,m]=i.useState(""),[p,x]=i.useState(1),[d,k]=i.useState(20),r=i.useMemo(()=>{const n=l.toLowerCase();return n?s.filter(f=>{const D=f.companyName?.toLowerCase()||"",y=f.appSlug?.toLowerCase()||"",S=f.id.toLowerCase();return D.includes(n)||y.includes(n)||S.includes(n)}):s},[l,s]),w=Math.ceil(r.length/d),j=i.useMemo(()=>{const n=(p-1)*d;return r.slice(n,n+d)},[r,p,d]);return i.useEffect(()=>{x(1)},[l,d]),e.jsxs(Qs,{title:"Manage Companies",icon:e.jsx(je,{size:20,className:"text-blue-600"}),className:"h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white flex flex-col sm:flex-row justify-between items-center gap-4 shrink-0",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Registered Companies: ",e.jsx("strong",{children:s.length})]})}),e.jsxs("div",{className:"relative w-full sm:w-72",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(le,{size:16,className:"text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search companies...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:l,onChange:n=>m(n.target.value)})]})]}),e.jsx("div",{className:"flex-1 overflow-auto min-h-0 bg-gray-50",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Company Name"}),e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Slug / ID"}),e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Plan"}),e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:a?e.jsx("tr",{children:e.jsxs("td",{colSpan:"4",className:"p-10 text-center text-gray-500",children:[e.jsx(G,{className:"animate-spin mx-auto mb-2"}),"Loading companies..."]})}):o.companies?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-10 text-center text-red-500",children:"Error loading companies."})}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-10 text-center text-gray-400",children:"No companies found."})}):j.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 align-middle",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 border border-gray-200 flex items-center justify-center text-lg font-bold text-gray-500 shrink-0",children:n.companyLogoUrl?e.jsx("img",{src:n.companyLogoUrl,alt:"Logo",className:"w-full h-full object-contain rounded-lg"}):R(n.companyName).charAt(0)}),e.jsx("span",{className:"font-semibold text-gray-900",children:R(n.companyName)})]})}),e.jsx("td",{className:"px-6 py-4 align-middle",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-sm font-mono text-blue-600 bg-blue-50 px-2 py-0.5 rounded w-fit",children:["/",R(n.appSlug)]}),e.jsx("span",{className:"text-xs text-gray-400 mt-1 font-mono",children:n.id})]})}),e.jsx("td",{className:"px-6 py-4 align-middle",children:n.planType==="paid"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-bold bg-yellow-100 text-yellow-800 border border-yellow-200",children:[e.jsx(Ps,{size:12,fill:"currentColor"})," Pro Plan"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-bold bg-gray-100 text-gray-600 border border-gray-200",children:[e.jsx(Ns,{size:12})," Free Plan"]})}),e.jsx("td",{className:"px-6 py-4 align-middle text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>t({id:n.id,name:n.companyName}),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"View Applications",children:e.jsx(re,{size:18})}),e.jsx("button",{onClick:()=>c(n.id),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Edit Company",children:e.jsx(be,{size:18})}),e.jsx("button",{onClick:()=>u({id:n.id,name:n.companyName}),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete Company",children:e.jsx(me,{size:18})})]})})]},n.id))})]})}),e.jsxs("div",{className:"border-t border-gray-200 p-4 bg-gray-50 flex flex-col sm:flex-row justify-between items-center gap-4 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{value:d,onChange:n=>k(Number(n.target.value)),className:"border-gray-300 rounded-md text-xs py-1.5 pl-2 pr-6 bg-white focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",e.jsx("strong",{children:p})," of ",e.jsx("strong",{children:w||1})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>x(n=>Math.max(1,n-1)),disabled:p===1,className:"p-2 rounded-md bg-white border border-gray-200 hover:bg-gray-50 disabled:opacity-50 disabled:hover:bg-white transition-all",children:e.jsx(Re,{size:16,className:"text-gray-600"})}),e.jsx("button",{onClick:()=>x(n=>Math.min(w,n+1)),disabled:p>=w,className:"p-2 rounded-md bg-white border border-gray-200 hover:bg-gray-50 disabled:opacity-50 disabled:hover:bg-white transition-all",children:e.jsx(Fe,{size:16,className:"text-gray-600"})})]})]})]})]})}function Ws({title:a,icon:o,children:s,className:t=""}){return e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col ${t}`,children:[e.jsx("div",{className:"p-5 border-b border-gray-200 shrink-0",children:e.jsxs("h2",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[o,a]})}),s]})}function Ys({listLoading:a,statsError:o,userList:s,allCompaniesMap:t,onEdit:c,onDelete:u}){const[l,m]=i.useState(""),[p,x]=i.useState(1),[d,k]=i.useState(20),r=i.useMemo(()=>{const n=l.toLowerCase();return n?s.filter(f=>f.name?.toLowerCase().includes(n)||f.email?.toLowerCase().includes(n)):s},[l,s]),w=Math.ceil(r.length/d),j=i.useMemo(()=>{const n=(p-1)*d;return r.slice(n,n+d)},[r,p,d]);return i.useEffect(()=>{x(1)},[l,d]),e.jsxs(Ws,{title:"Manage All Users",icon:e.jsx(ce,{size:20,className:"text-blue-600"}),className:"h-full",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-white flex flex-col sm:flex-row justify-between items-center gap-4 shrink-0",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-500",children:["Total Users: ",e.jsx("strong",{children:s.length})]})}),e.jsxs("div",{className:"relative w-full sm:w-72",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(le,{size:16,className:"text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",value:l,onChange:n=>m(n.target.value)})]})]}),e.jsx("div",{className:"flex-1 overflow-auto min-h-0 bg-gray-50",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"User"}),e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Role & Access"}),e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200 text-right",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:a?e.jsx("tr",{children:e.jsxs("td",{colSpan:"3",className:"p-10 text-center text-gray-500",children:[e.jsx(G,{className:"animate-spin mx-auto mb-2"}),"Loading users..."]})}):o.users?e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"p-10 text-center text-red-500",children:"Error loading users."})}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"3",className:"p-10 text-center text-gray-400",children:"No users found."})}):j.map(n=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 align-middle",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-full bg-purple-100 border border-purple-200 flex items-center justify-center text-sm font-bold text-purple-700 shrink-0",children:R(n.name).charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-gray-900",children:R(n.name)}),e.jsx("p",{className:"text-xs text-gray-500",children:R(n.email)})]})]})}),e.jsx("td",{className:"px-6 py-4 align-middle",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:n.globalRole==="super_admin"?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-bold bg-red-100 text-red-800 border border-red-200",children:[e.jsx(ws,{size:12})," Super Admin"]}):n.memberships.length>0?n.memberships.map(f=>e.jsxs("div",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-100",children:[e.jsx(_e,{size:12}),f.role==="company_admin"?"Admin":"User"," at ",t.get(f.companyId)||"Unknown"]},f.companyId)):e.jsx("span",{className:"text-xs text-gray-400 italic",children:"No active memberships"})})}),e.jsx("td",{className:"px-6 py-4 align-middle text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>c({id:n.id}),className:"p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Edit User",children:e.jsx(be,{size:18})}),e.jsx("button",{onClick:()=>u({id:n.id,name:n.name}),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Delete User",children:e.jsx(me,{size:18})})]})})]},n.id))})]})}),e.jsxs("div",{className:"border-t border-gray-200 p-4 bg-gray-50 flex flex-col sm:flex-row justify-between items-center gap-4 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("span",{children:"Show"}),e.jsxs("select",{value:d,onChange:n=>k(Number(n.target.value)),className:"border-gray-300 rounded-md text-xs py-1.5 pl-2 pr-6 bg-white focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]}),e.jsx("span",{children:"per page"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",e.jsx("strong",{children:p})," of ",e.jsx("strong",{children:w||1})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>x(n=>Math.max(1,n-1)),disabled:p===1,className:"p-2 rounded-md bg-white border border-gray-200 hover:bg-gray-50 disabled:opacity-50 disabled:hover:bg-white transition-all",children:e.jsx(Re,{size:16,className:"text-gray-600"})}),e.jsx("button",{onClick:()=>x(n=>Math.min(w,n+1)),disabled:p>=w,className:"p-2 rounded-md bg-white border border-gray-200 hover:bg-gray-50 disabled:opacity-50 disabled:hover:bg-white transition-all",children:e.jsx(Fe,{size:16,className:"text-gray-600"})})]})]})]})]})}function Ks({onDataUpdate:a,onClose:o}){const{csvData:s,step:t,setStep:c,importMethod:u,setImportMethod:l,sheetUrl:m,setSheetUrl:p,processingSheet:x,handleSheetImport:d,handleFileChange:k,reset:r}=gs(),[w,j]=i.useState(!1),[n,f]=i.useState(""),[D,y]=i.useState({created:0,updated:0}),S=async()=>{j(!0),f("Syncing to Global Database...");let N=0,T=0;try{let b=Se(U),P=0;for(let v=0;v<s.length;v++){const h=s[v];f(`Processing ${v+1} / ${s.length}...`);let C=null,A=null;const z=V(U,"drivers");if(!h.isEmailPlaceholder){const E=W(z,ke("personalInfo.email","==",h.email)),I=await Q(E);I.empty||(C=I.docs[0])}if(!C&&h.normalizedPhone){const E=W(z,ke("personalInfo.normalizedPhone","==",h.normalizedPhone)),I=await Q(E);I.empty||(C=I.docs[0])}if(C){A=C.id,T++;const E=q(U,"drivers",A),I={lastUpdatedAt:Y(),"driverProfile.isBulkUpload":!0};h.firstName&&(I["personalInfo.firstName"]=h.firstName),h.lastName&&(I["personalInfo.lastName"]=h.lastName),h.phone&&(I["personalInfo.phone"]=h.phone),h.normalizedPhone&&(I["personalInfo.normalizedPhone"]=h.normalizedPhone),h.city&&(I["personalInfo.city"]=h.city),h.state&&(I["personalInfo.state"]=h.state),h.experience&&(I["qualifications.experienceYears"]=h.experience),h.driverType&&(I["driverProfile.type"]=h.driverType),b.update(E,I)}else{N++;const E=q(V(U,"drivers"));A=E.id;const I={personalInfo:{firstName:h.firstName,lastName:h.lastName,email:h.email,phone:h.phone,normalizedPhone:h.normalizedPhone||"",city:h.city,state:h.state,zip:""},driverProfile:{type:h.driverType,availability:"actively_looking",isBulkUpload:!0,isEmailPlaceholder:!!h.isEmailPlaceholder},qualifications:{experienceYears:h.experience||"New"},createdAt:Y(),lastUpdatedAt:Y(),source:u==="gsheet"?"admin_gsheet_import":"admin_file_import"};b.set(E,I)}const L=q(U,"leads",A),F={firstName:h.firstName,lastName:h.lastName,email:h.email,phone:h.phone,normalizedPhone:h.normalizedPhone||"",driverType:h.driverType,experience:h.experience||"New",source:"SafeHaul Network",createdAt:Y(),unavailableUntil:null};b.set(L,F,{merge:!0}),P++,P>=150&&(await b.commit(),b=Se(U),P=0)}P>0&&await b.commit(),y({created:N,updated:T}),c("success"),a&&a()}catch(g){console.error("Bulk Upload Error:",g),alert("Error processing batch: "+g.message)}finally{j(!1)}};return e.jsx(hs,{title:"Bulk Lead Adding (Global Pool)",step:t,importMethod:u,setImportMethod:l,sheetUrl:m,setSheetUrl:p,processingSheet:x,handleSheetImport:d,handleFileChange:k,csvData:s,reset:r,onConfirm:S,onClose:o,uploading:w,progress:n,stats:D})}function Ee({title:a,icon:o,children:s,className:t=""}){return e.jsxs("div",{className:`bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden ${t}`,children:[e.jsx("div",{className:"p-5 border-b border-gray-200",children:e.jsxs("h2",{className:"text-xl font-semibold text-gray-700 flex items-center gap-3",children:[o,a]})}),e.jsx("div",{className:"p-5",children:s})]})}function B({id:a,label:o,type:s="text",required:t=!1,...c}){return e.jsxs("div",{children:[e.jsx("label",{htmlFor:a,className:"block text-sm font-medium text-gray-700 mb-1",children:o}),e.jsx("input",{type:s,id:a,name:a,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition",required:t,...c})]})}function Xs({allCompaniesMap:a,onDataUpdate:o}){const[s,t]=i.useState({name:"",slug:"",phone:"",email:"",street:"",city:"",state:"",zip:"",mc:"",dot:""}),[c,u]=i.useState(null),[l,m]=i.useState(!1),[p,x]=i.useState(""),[d,k]=i.useState(""),[r,w]=i.useState({fullName:"",email:"",password:"",companyId:"",role:"company_admin"}),[j,n]=i.useState(!1),[f,D]=i.useState(""),[y,S]=i.useState(""),N=v=>{t(h=>({...h,[v.target.id]:v.target.value}))},T=v=>{v.target.files[0]?u(v.target.files[0]):u(null)},g=v=>{w(h=>({...h,[v.target.id]:v.target.value}))},b=async v=>{v.preventDefault(),m(!0),k(""),x("");const h={companyName:s.name,appSlug:s.slug.toLowerCase().trim(),address:{street:s.street,city:s.city,state:s.state.toUpperCase(),zip:s.zip},contact:{phone:s.phone,email:s.email},legal:{mcNumber:s.mc,dotNumber:s.dot},companyLogoUrl:""};let C=null;try{if(C=(await es(h)).id,x(`Successfully created ${h.companyName}.`),c){x("Company created. Uploading logo...");const z=await Ve(C,c);await Be(C,{companyLogoUrl:z}),x("Successfully created company and uploaded logo!")}t({name:"",slug:"",phone:"",email:"",street:"",city:"",state:"",zip:"",mc:"",dot:""}),u(null),document.getElementById("logo").value=null,o()}catch(A){k(A.message),C&&c&&k(`Company created, but logo upload failed: ${A.message}`)}finally{m(!1)}},P=async v=>{v.preventDefault(),n(!0),S(""),D("");try{const C=await te(ae,"createPortalUser")({fullName:r.fullName,email:r.email,password:r.password,companyId:r.companyId,role:r.role});D(C.data.message),w({fullName:"",email:"",password:"",companyId:"",role:"company_admin"}),o()}catch(h){S(h.message)}finally{n(!1)}};return e.jsxs("div",{className:"space-y-8",children:[e.jsx(Ee,{title:"Create New Company",icon:e.jsx(He,{size:22}),children:e.jsxs("form",{className:"space-y-4",onSubmit:b,children:[e.jsx(B,{id:"name",label:"Company Name",required:!0,value:s.name,onChange:N}),e.jsx(B,{id:"slug",label:"Unique URL Slug",required:!0,value:s.slug,onChange:N}),e.jsx(B,{id:"logo",label:"Company Logo",type:"file",onChange:T,accept:"image/png, image/jpeg"}),e.jsx(B,{id:"phone",label:"Contact Phone",type:"tel",value:s.phone,onChange:N}),e.jsx(B,{id:"email",label:"Contact Email",type:"email",value:s.email,onChange:N}),e.jsx(B,{id:"street",label:"Street",value:s.street,onChange:N}),e.jsx(B,{id:"city",label:"City",value:s.city,onChange:N}),e.jsx(B,{id:"state",label:"State (e.g., IL)",value:s.state,onChange:N,maxLength:"2"}),e.jsx(B,{id:"zip",label:"ZIP Code",value:s.zip,onChange:N}),e.jsx(B,{id:"mc",label:"MC Number",value:s.mc,onChange:N}),e.jsx(B,{id:"dot",label:"DOT Number",value:s.dot,onChange:N}),p&&e.jsx("p",{className:"text-sm text-green-600",children:p}),d&&e.jsx("p",{className:"text-sm text-red-600",children:d}),e.jsx("button",{type:"submit",className:"w-full py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 disabled:opacity-50 transition-all shadow-md hover:shadow-lg",disabled:l,children:l?"Creating...":"Create Company"})]})}),e.jsx(Ee,{title:"Create New Company User",icon:e.jsx(Je,{size:22}),children:e.jsxs("form",{className:"space-y-4",onSubmit:P,children:[e.jsx(B,{id:"fullName",label:"Full Name",required:!0,value:r.fullName,onChange:g}),e.jsx(B,{id:"email",label:"Email Address",type:"email",required:!0,value:r.email,onChange:g}),e.jsx(B,{id:"password",label:"Temporary Password",type:"password",required:!0,value:r.password,onChange:g}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"companyId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Assign to Company"}),e.jsxs("select",{id:"companyId",className:"w-full p-3 border border-gray-300 rounded-lg bg-white",required:!0,value:r.companyId,onChange:g,children:[e.jsx("option",{value:"",children:"-- Select a company --"}),Array.from(a.entries()).map(([v,h])=>e.jsx("option",{value:v,children:h},v))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Role"}),e.jsxs("select",{id:"role",className:"w-full p-3 border border-gray-300 rounded-lg bg-white",required:!0,value:r.role,onChange:g,children:[e.jsx("option",{value:"company_admin",children:"Company Admin (Can manage)"}),e.jsx("option",{value:"hr_user",children:"HR User (Can view)"})]})]}),f&&e.jsx("p",{className:"text-sm text-green-600",children:f}),y&&e.jsx("p",{className:"text-sm text-red-600",children:y}),e.jsx("button",{type:"submit",className:"w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-all shadow-md hover:shadow-lg",disabled:j,children:j?"Creating User...":"Create User"})]})})]})}function Ue({title:a,icon:o,children:s,className:t=""}){return e.jsxs("div",{className:`bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden flex flex-col ${t}`,children:[e.jsx("div",{className:"p-5 border-b border-gray-200 shrink-0",children:e.jsxs("h2",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[o,a]})}),s]})}function Js({companyList:a,onDataUpdate:o}){const{showSuccess:s,showError:t,showInfo:c}=Pe(),[u,l]=i.useState(""),[m,p]=i.useState(!1),[x,d]=i.useState(!1),k=i.useMemo(()=>{if(!u)return a;const j=u.toLowerCase();return a.filter(n=>n.companyName?.toLowerCase().includes(j))},[a,u]),r=async(j,n,f)=>{try{const D=q(U,"companies",j.id);await he(D,{[`features.${n}`]:!f}),s(`Updated ${j.companyName}`),o()}catch(D){console.error("Update failed:",D),t("Failed to toggle feature.")}},w=async(j,n)=>{if(window.confirm(`Are you sure you want to ${n?"ENABLE":"DISABLE"} ${j} for ALL ${a.length} companies?`)){d(!0),c("Processing bulk update...");try{const D=[];for(let y=0;y<a.length;y+=400)D.push(a.slice(y,y+400));for(const y of D){const S=Se(U);y.forEach(N=>{const T=q(U,"companies",N.id);S.update(T,{[`features.${j}`]:n})}),await S.commit()}s(`Successfully ${n?"Enabled":"Disabled"} feature for all companies.`),o()}catch(f){console.error("Bulk update failed:",f),t("Bulk update failed.")}finally{d(!1)}}};return e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsx(Ue,{title:"Global Feature Controls",icon:e.jsx(Ze,{size:20,className:"text-blue-600"}),className:"shrink-0",children:e.jsx("div",{className:"p-6 bg-gradient-to-r from-gray-50 to-white",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:"Search For Drivers Access"}),e.jsx("p",{className:"text-sm text-gray-500",children:'Control access to the "Search For Drivers" global database. If disabled, users will see the "Under Development" screen with a redirect to SafeHaul Leads.'})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>w("searchDB",!1),disabled:x,className:"flex items-center gap-2 px-4 py-2 bg-white border border-red-200 text-red-600 font-bold rounded-lg hover:bg-red-50 hover:border-red-300 transition shadow-sm disabled:opacity-50",children:[x?e.jsx(G,{className:"animate-spin",size:18}):e.jsx(ze,{size:18}),"Disable for All"]}),e.jsxs("button",{onClick:()=>w("searchDB",!0),disabled:x,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition shadow-md disabled:opacity-50",children:[x?e.jsx(G,{className:"animate-spin",size:18}):e.jsx(Es,{size:18}),"Enable for All"]})]})]})})}),e.jsxs(Ue,{title:"Company Feature Overrides",icon:e.jsx(fe,{size:20,className:"text-purple-600"}),className:"flex-1 min-h-0",children:[e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(le,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search companies...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none",value:u,onChange:j=>l(j.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-auto bg-gray-50",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200",children:"Company Name"}),e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200 text-center",children:"Search For Drivers"}),e.jsx("th",{className:"px-6 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider border-b border-gray-200 text-right",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 bg-white",children:k.map(j=>{const n=j.features?.searchDB===!0;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:j.companyName}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{onClick:()=>r(j,"searchDB",n),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${n?"bg-green-500":"bg-gray-200"}`,children:e.jsx("span",{className:`${n?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition-transform`})})}),e.jsx("td",{className:"px-6 py-4 text-right",children:n?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-bold bg-green-100 text-green-700 border border-green-200",children:[e.jsx(qe,{size:12})," Active"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-bold bg-gray-100 text-gray-500 border border-gray-200",children:[e.jsx(ze,{size:12})," Locked"]})})]},j.id)})})]})})]})]})}const et={apiKey:"AIzaSyBD2Zd4qjZCdqf3B2Gd13xjooTicvc-tXY",authDomain:"truckerapp-system.firebaseapp.com",projectId:"truckerapp-system",storageBucket:"truckerapp-system.firebasestorage.app",messagingSenderId:"725898258453",appId:"1:725898258453:web:5a5f0490e7baf3e518061c"};function st(){const[a,o]=i.useState(!1),[s,t]=i.useState(!1),[c,u]=i.useState([]),[l,m]=i.useState(0),[p,x]=i.useState("idle"),[d,k]=i.useState(null),r=(f,D="info")=>{u(y=>[...y,{id:Date.now(),time:new Date().toLocaleTimeString(),message:f,type:D}])},w=async(f,D)=>{r("Step 0: Spawning 'Anonymous Driver' Probe...","info");const y=ts(et,"PermissionsProbe"),S=as(y),N=rs(y);try{await ls(S);const T=S.currentUser;r(`ðŸ•µï¸ Probe Active: ID ${T.uid}`,"info"),r("Step 0.1: Probe attempting to CREATE application...","info");const g=q(N,"companies",f,"applications",D);await Te(g,{firstName:"Probe",lastName:"User",driverId:T.uid,createdAt:Y(),status:"draft"}),r("âœ… Probe Creation: Success (Rules Allowed)","success"),r("Step 0.2: Probe attempting to UPDATE own application...","info"),await he(g,{email:"probe@test.com",updatedAt:Y()}),r("âœ… Probe Update: Success (Ownership Rules Working)","success")}catch(T){throw console.error("Probe Failed:",T),T.code==="permission-denied"?new Error("PERMISSION DENIED: The database rules blocked the Driver. Update your Firestore Rules."):new Error(`Probe Error: ${T.message}`)}finally{await ns(y)}},j=i.useCallback(async()=>{if(!ue.currentUser){r("âŒ ERROR: Not authenticated. Please log in.","error"),x("error");return}const D=(await ue.currentUser.getIdTokenResult()).claims;if(!(D?.roles?.globalRole==="super_admin"||D?.globalRole==="super_admin")){r("âŒ ERROR: Only Global Super Admins can run system diagnostics.","error"),r("Company-level admins do not have access to this feature.","warning"),x("error");return}o(!0),u([]),m(0),x("running"),k(null);const S=`test_sys_${Date.now()}`,N=`diagnostics_company_${Date.now()}`,T=`app_${S}`;try{r("âœ… Super Admin verified. Initializing...","info");const g=q(U,"companies",N);if(await Te(g,{companyName:"System Diagnostics Inc.",appSlug:`test-${Date.now()}`,createdAt:Y(),isTest:!0}),m(10),await w(N,T),m(30),r("Step 2: Testing Configuration Sync...","info"),await he(g,{customQuestions:[{id:"q1",type:"shortAnswer",label:"Test?",required:!0}]}),!(await De(g)).data().customQuestions)throw new Error("Config Sync Failed.");m(40),r("âœ… Custom Questions Synced.","success"),r("Step 3: Verifying Probe Data...","info");const v=q(U,"companies",N,"applications",T),h=await De(v);if(!h.exists())throw new Error("Data Loss: Application not found.");if(h.data().firstName!=="Probe")throw new Error("Data Corruption.");m(60),r("âœ… Admin successfully read Probe data.","success"),r("Step 4: Testing Recruiter Workflow...","info"),await he(v,{status:"In Review"}),m(70),r("âœ… Status Update Processed.","success"),r("Step 5: Verifying Call Counter Logic...","info");const C=V(U,"companies",N,"applications",T,"activities");await ss(C,{type:"call",outcome:"interested",outcomeLabel:"Connected / Interested",isContact:!0,performedBy:ue.currentUser.uid,companyId:N,timestamp:Y()}),await new Promise(E=>setTimeout(E,2500));const A=new Date,z=new Date(A);z.setDate(A.getDate()-1);const L=new Date(A);L.setDate(A.getDate()+1);const F=te(ae,"getTeamPerformanceHistory");try{const K=(await F({companyId:N,startDate:z.toISOString(),endDate:L.toISOString()})).data.data.find(X=>X.id===ue.currentUser.uid);if(!K||K.dials<1)throw new Error("Backend Counter Failed.");r(`âœ… Counter Working: Detected ${K.dials} call(s).`,"success")}catch(E){if(E.message.includes("requires an index"))r("âš ï¸ INDEX MISSING (Check Console)","error"),console.error("INDEX LINK:",E);else throw E}m(90),r("â¸ï¸ PAUSED: Test data preserved.","warning"),k({companyId:N,appId:T}),x("waiting_cleanup")}catch(g){console.error("Diagnostics Failed:",g),r(`âŒ FAILURE: ${g.message}`,"error"),x("error"),N&&k({companyId:N,appId:T})}finally{o(!1)}},[]),n=i.useCallback(async()=>{if(d){t(!0),r("Step 6: Cleaning up test data...","warning");try{const f=V(U,"companies",d.companyId,"applications",d.appId,"activities"),D=await Q(W(f));for(const N of D.docs)await ye(N.ref).catch(T=>console.warn("Activity clean skip",T));r("âœ… Activities cleaned.","success");const y=q(U,"companies",d.companyId,"applications",d.appId);await ye(y).catch(N=>console.warn("App clean skip",N)),r("âœ… Test application removed.","success");const S=q(U,"companies",d.companyId);await ye(S).catch(N=>console.warn("Comp clean skip",N)),r("âœ… Test company removed.","success"),m(100),r("âœ… Cleanup Complete. System is HEALTHY.","success"),x("success"),k(null)}catch(f){r(`âŒ Cleanup Failed: ${f.message}`,"error")}finally{t(!1)}}},[d]);return{runDiagnostics:j,runCleanup:n,isRunning:a,isCleaning:s,logs:c,progress:l,status:p,testData:d}}function tt(){const{runDiagnostics:a,runCleanup:o,isRunning:s,isCleaning:t,logs:c,progress:u,status:l}=st(),m=()=>l==="success"?"bg-green-100 text-green-700 border-green-200":l==="error"?"bg-red-100 text-red-700 border-red-200":l==="waiting_cleanup"?"bg-yellow-100 text-yellow-700 border-yellow-200":s?"bg-blue-100 text-blue-700 border-blue-200":"bg-gray-100 text-gray-600 border-gray-200",p=()=>l==="success"?e.jsx(qe,{size:24}):l==="error"?e.jsx(os,{size:24}):l==="waiting_cleanup"?e.jsx(Le,{size:24}):s?e.jsx(G,{size:24,className:"animate-spin"}):e.jsx(Ae,{size:24}),x=()=>l==="waiting_cleanup"?"Verify Data":l==="idle"?"Ready":l;return e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm shrink-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Ae,{className:"text-blue-600"})," System Health Diagnostics"]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1 max-w-2xl",children:"This tool runs a full end-to-end simulation of your platform. It tests infrastructure, backend triggers, and call counters. It pauses before cleanup so you can manually verify data."})]}),e.jsxs("div",{className:`px-4 py-2 rounded-lg border flex items-center gap-2 font-bold ${m()}`,children:[p(),e.jsx("span",{className:"uppercase text-sm",children:x()})]})]}),e.jsx("div",{className:"mt-6 flex items-center gap-4",children:l==="waiting_cleanup"?e.jsxs("button",{onClick:o,disabled:t,className:`w-full sm:w-auto px-6 py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-all shadow-md
                                ${t?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-700 hover:shadow-lg"}`,children:[t?e.jsx(G,{className:"animate-spin",size:18}):e.jsx(me,{size:18}),t?"Cleaning Up...":"Delete Test Data"]}):e.jsxs("button",{onClick:a,disabled:s,className:`w-full sm:w-auto px-6 py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-all shadow-md
                                ${s?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 hover:shadow-lg"}`,children:[s?"Running Simulation...":"Start Full System Test",!s&&e.jsx(Ms,{size:18,fill:"currentColor"})]})})]}),l!=="idle"&&e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm shrink-0 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold text-gray-500 uppercase mb-2",children:[e.jsx("span",{children:"Progress"}),e.jsxs("span",{children:[u,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-100 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ease-out 
                                ${l==="error"?"bg-red-500":l==="waiting_cleanup"?"bg-yellow-500":"bg-blue-600"}`,style:{width:`${u}%`}})})]}),e.jsxs("div",{className:"flex-1 min-h-0 bg-gray-900 rounded-xl shadow-inner border border-gray-800 flex flex-col overflow-hidden font-mono text-sm",children:[e.jsxs("div",{className:"bg-gray-800 p-3 border-b border-gray-700 flex items-center gap-2 text-gray-400",children:[e.jsx(_s,{size:16}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Diagnostics Console"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-2",children:[c.length===0&&l==="idle"&&e.jsx("div",{className:"text-gray-600 italic text-center mt-10",children:"Waiting to start diagnostics..."}),c.map(d=>e.jsxs("div",{className:`flex gap-3 ${d.type==="error"?"text-red-400":d.type==="success"?"text-green-400":d.type==="warning"?"text-yellow-400":"text-blue-300"}`,children:[e.jsxs("span",{className:"text-gray-600 shrink-0",children:["[",d.time,"]"]}),e.jsx("span",{children:d.message})]},d.id)),(s||t)&&e.jsxs("div",{className:"flex gap-3 text-gray-500 animate-pulse",children:[e.jsx("span",{className:"invisible",children:"[]"}),e.jsx("span",{children:"_"})]})]})]})]})}const Me="America/Chicago";function at(){const[a,o]=i.useState(!0),[s,t]=i.useState({summary:{totalCalls:0,totalEmails:0,totalApplications:0,activeRecruiters:0},companyPerformance:[],userPerformance:[],dailyTrend:[]}),[c,u]=i.useState("7d"),l=()=>{const x=new Date().toLocaleString("en-US",{timeZone:Me});return new Date(x)},m=p=>{if(!p)return null;const x=p.toDate?p.toDate():new Date(p);return new Intl.DateTimeFormat("en-US",{timeZone:Me,month:"short",day:"numeric"}).format(x)};return i.useEffect(()=>{let p=!0;return(async()=>{o(!0);try{const d=l(),k=new Date(d);k.setHours(23,59,59,999);const r=new Date(d);c==="7d"&&r.setDate(r.getDate()-6),c==="30d"&&r.setDate(r.getDate()-29),c==="90d"&&r.setDate(r.getDate()-89),r.setHours(0,0,0,0);const w=new Date(r.getTime()-864e5),j=is.fromDate(w),n=await Q(V(U,"companies")),f={};n.forEach(z=>{const L=z.data();f[z.id]=L.companyName||"Unknown Company"});const D=ie(U,"activities"),y=W(D,ke("timestamp",">=",j)),S=await Q(y);if(!p)return;let N=0,T=0;const g={},b={},P={};let v=new Date(r);for(;v<=k;){const z=new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(v);P[z]=0,v.setDate(v.getDate()+1)}S.forEach(z=>{const L=z.data();if(!L.timestamp)return;const F=m(L.timestamp);if(!P.hasOwnProperty(F))return;const E=L.companyId||"unknown",I=L.performedBy||"system";g[E]||(g[E]={companyId:E,companyName:f[E]||(E==="unknown"?"System/Unknown":"Unknown Company"),callsMade:0,actions:0}),b[I]?L.timestamp>b[I].lastActive&&(b[I].lastActive=L.timestamp,L.performedByName&&(b[I].userName=L.performedByName)):b[I]={userId:I,userName:L.performedByName||"Unknown User",companyName:f[E]||"Unknown",callsMade:0,lastActive:L.timestamp},L.type==="call"&&(N++,g[E].callsMade++,b[I].callsMade++),g[E].actions++,P[F]++});const h=Object.values(g).filter(z=>z.companyId!=="unknown").sort((z,L)=>L.callsMade-z.callsMade),C=Object.values(b).filter(z=>z.userId!=="system").sort((z,L)=>L.callsMade-z.callsMade),A=Object.entries(P).map(([z,L])=>({date:z,value:L}));t({summary:{totalCalls:N,totalEmails:T,totalApplications:0,activeRecruiters:C.length},companyPerformance:h,userPerformance:C,dailyTrend:A})}catch(d){console.error("Analytics Error:",d)}finally{p&&o(!1)}})(),()=>{p=!1}},[c]),{loading:a,stats:s,dateRange:c,setDateRange:u}}function ge({title:a,value:o,icon:s,colorClass:t,trend:c}){return e.jsxs("div",{className:"bg-white p-5 rounded-xl border border-gray-200 shadow-sm flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-1",children:a}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:o}),c&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs font-medium text-green-600 bg-green-50 w-fit px-2 py-0.5 rounded",children:[e.jsx(We,{size:12}),e.jsx("span",{children:c})]})]}),e.jsx("div",{className:`p-3 rounded-lg ${t}`,children:e.jsx(s,{size:20})})]})}function rt({data:a}){if(!a||a.length===0)return e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-400 text-sm",children:"No data available"});const o=200,s=800,t=20,c=Math.max(...a.map(l=>l.value),5),u=a.map((l,m)=>{const p=m/(a.length-1)*(s-t*2)+t,x=o-l.value/c*(o-t*2)-t;return`${p},${x}`}).join(" ");return e.jsx("div",{className:"w-full h-64 overflow-hidden",children:e.jsxs("svg",{viewBox:`0 0 ${s} ${o}`,className:"w-full h-full overflow-visible",children:[[0,.25,.5,.75,1].map(l=>e.jsx("line",{x1:t,y1:o-l*(o-t*2)-t,x2:s-t,y2:o-l*(o-t*2)-t,stroke:"#f3f4f6",strokeWidth:"1"},l)),e.jsx("polyline",{fill:"none",stroke:"#2563eb",strokeWidth:"3",points:u,strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("polygon",{fill:"url(#gradient)",points:`${t},${o-t} ${u} ${s-t},${o-t}`,opacity:"0.1"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"gradient",x1:"0",x2:"0",y1:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#2563eb"}),e.jsx("stop",{offset:"100%",stopColor:"white"})]})}),e.jsx("text",{x:t,y:o,className:"text-[10px] fill-gray-400",children:a[0]?.date}),e.jsx("text",{x:s/2,y:o,className:"text-[10px] fill-gray-400 text-anchor-middle",children:a[Math.floor(a.length/2)]?.date}),e.jsx("text",{x:s-t,y:o,className:"text-[10px] fill-gray-400 text-anchor-end",children:a[a.length-1]?.date})]})})}function lt(){const{stats:a,dateRange:o,setDateRange:s}=at(),[t,c]=i.useState("overview"),u=()=>{let l=[],m=[],p="export.csv";t==="users"?(l=["Recruiter Name","Company","Calls Made","Last Active"],m=a.userPerformance.map(r=>[r.userName,r.companyName,r.callsMade,r.lastActive?new Date(r.lastActive.seconds*1e3).toLocaleString():"N/A"]),p=`recruiter_performance_${o}.csv`):(l=["Company Name","Calls Made","Total Actions"],m=a.companyPerformance.map(r=>[r.companyName,r.callsMade,r.actions]),p=`company_performance_${o}.csv`);const x="data:text/csv;charset=utf-8,"+[l,...m].map(r=>r.join(",")).join(`
`),d=encodeURI(x),k=document.createElement("a");k.setAttribute("href",d),k.setAttribute("download",p),document.body.appendChild(k),k.click(),document.body.removeChild(k)};return e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 bg-white p-4 rounded-xl border border-gray-200 shadow-sm shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Qe,{className:"text-blue-600"})," Platform Analytics"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Monitor usage and performance across all companies."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:["7d","30d","90d"].map(l=>e.jsx("button",{onClick:()=>s(l),className:`px-3 py-1.5 text-xs font-bold rounded-md transition-all ${o===l?"bg-white text-blue-700 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:l.toUpperCase()},l))}),e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm font-bold rounded-lg hover:bg-blue-700 transition shadow-sm",children:[e.jsx(ys,{size:16})," Export ",t==="users"?"Recruiters":"Companies"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 shrink-0",children:[e.jsx(ge,{title:"Total Calls",value:a.summary.totalCalls,icon:cs,colorClass:"bg-blue-100 text-blue-600",trend:"Real-time"}),e.jsx(ge,{title:"Active Companies",value:a.companyPerformance.length,icon:ce,colorClass:"bg-purple-100 text-purple-600",trend:"Active"}),e.jsx(ge,{title:"Active Recruiters",value:a.summary.activeRecruiters,icon:Oe,colorClass:"bg-orange-100 text-orange-600",trend:"This Period"}),e.jsx(ge,{title:"Platform Health",value:"100%",icon:fe,colorClass:"bg-yellow-100 text-yellow-600",trend:"Operational"})]}),e.jsxs("div",{className:"flex-1 min-h-0 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex border-b border-gray-200 px-6 pt-2 overflow-x-auto",children:[e.jsx("button",{onClick:()=>c("overview"),className:`py-3 px-4 text-sm font-bold border-b-2 transition-colors whitespace-nowrap ${t==="overview"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-800"}`,children:"Activity Overview"}),e.jsx("button",{onClick:()=>c("companies"),className:`py-3 px-4 text-sm font-bold border-b-2 transition-colors whitespace-nowrap ${t==="companies"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-800"}`,children:"Company Performance"}),e.jsx("button",{onClick:()=>c("users"),className:`py-3 px-4 text-sm font-bold border-b-2 transition-colors whitespace-nowrap ${t==="users"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-800"}`,children:"Recruiter Stats"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6 bg-gray-50",children:[t==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("h4",{className:"text-sm font-bold text-gray-800 mb-6 flex items-center gap-2",children:[e.jsx(We,{size:16,className:"text-blue-500"})," Daily Activity Trend"]}),e.jsx(rt,{data:a.dailyTrend})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-4",children:"Top Companies (By Calls)"}),e.jsxs("div",{className:"space-y-4",children:[a.companyPerformance.slice(0,5).map((l,m)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-50 flex items-center justify-center text-blue-600 font-bold text-xs",children:m+1}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:l.companyName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-24 bg-gray-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${l.callsMade/(a.summary.totalCalls||1)*100}%`}})}),e.jsxs("span",{className:"text-xs font-bold text-gray-600",children:[l.callsMade," calls"]})]})]},m)),a.companyPerformance.length===0&&e.jsx("p",{className:"text-xs text-gray-400 italic",children:"No data yet."})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-800 mb-4",children:"Top Recruiters (By Calls)"}),e.jsxs("div",{className:"space-y-4",children:[a.userPerformance.slice(0,5).map((l,m)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-50 flex items-center justify-center text-purple-600 font-bold text-xs",children:m+1}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:l.userName}),e.jsx("p",{className:"text-[10px] text-gray-400",children:l.companyName})]})]}),e.jsxs("span",{className:"text-xs font-bold text-gray-600",children:[l.callsMade," calls"]})]},m)),a.userPerformance.length===0&&e.jsx("p",{className:"text-xs text-gray-400 italic",children:"No data yet."})]})]})]})]}),t==="companies"&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-xs font-bold text-gray-500 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 border-b border-gray-200",children:"Company"}),e.jsx("th",{className:"px-6 py-4 border-b border-gray-200 text-center",children:"Calls Made"}),e.jsx("th",{className:"px-6 py-4 border-b border-gray-200 text-center",children:"Total Actions"}),e.jsx("th",{className:"px-6 py-4 border-b border-gray-200 text-right",children:"Engagement"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[a.companyPerformance.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-medium text-gray-900",children:l.companyName}),e.jsx("td",{className:"px-6 py-4 text-center text-gray-600",children:l.callsMade}),e.jsx("td",{className:"px-6 py-4 text-center text-gray-600",children:l.actions}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold ${l.callsMade>20?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:[l.callsMade>20?"High":"Low"," ",e.jsx(ks,{size:12})]})})]},l.companyId)),a.companyPerformance.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-6 text-center text-gray-400 italic",children:"No data found for this period."})})]})]})}),t==="users"&&e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 text-xs font-bold text-gray-500 uppercase",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 border-b border-gray-200",children:"Recruiter Name"}),e.jsx("th",{className:"px-6 py-4 border-b border-gray-200",children:"Company"}),e.jsx("th",{className:"px-6 py-4 border-b border-gray-200 text-center",children:"Calls Made"}),e.jsx("th",{className:"px-6 py-4 border-b border-gray-200 text-right",children:"Last Active"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[a.userPerformance.map(l=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 font-bold text-gray-900",children:l.userName}),e.jsx("td",{className:"px-6 py-4 text-gray-600",children:l.companyName}),e.jsx("td",{className:"px-6 py-4 text-center text-blue-600 font-mono font-bold",children:l.callsMade}),e.jsx("td",{className:"px-6 py-4 text-right text-sm text-gray-500",children:l.lastActive?.toDate?l.lastActive.toDate().toLocaleString():"Unknown"})]},l.userId)),a.userPerformance.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"p-6 text-center text-gray-400 italic",children:"No activity found for this period."})})]})]})})]})]})]})}const nt=({type:a})=>{switch(a){case"Company App":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-blue-100 text-blue-700 border border-blue-200",children:[e.jsx(re,{size:12})," Direct App"]});case"Global Pool":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-purple-100 text-purple-700 border border-purple-200",children:[e.jsx(fe,{size:12})," Global Pool"]});case"Distributed Lead":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-indigo-100 text-indigo-700 border border-indigo-200",children:[e.jsx(Rs,{size:12})," Distributed"]});case"Company Import":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-bold bg-orange-100 text-orange-700 border border-orange-200",children:[e.jsx(_e,{size:12})," Company Import"]});default:return e.jsx("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-600",children:a})}};function ot({allApplications:a,allCompaniesMap:o,onAppClick:s,onDataUpdate:t}){const{showSuccess:c,showError:u}=Pe(),[l,m]=i.useState(""),[p,x]=i.useState("All"),[d,k]=i.useState({key:"date",direction:"desc"}),[r,w]=i.useState(null),[j,n]=i.useState(1),[f,D]=i.useState(50),y=i.useMemo(()=>{let g=[...a];if(l){const b=l.toLowerCase();g=g.filter(P=>{const v=`${P.firstName||""} ${P.lastName||""}`.toLowerCase(),h=(P.email||"").toLowerCase(),C=(P.phone||"").toLowerCase(),A=(o.get(P.companyId)||"").toLowerCase();return v.includes(b)||h.includes(b)||C.includes(b)||A.includes(b)})}return p!=="All"&&(g=g.filter(b=>b.sourceType===p)),g.sort((b,P)=>{const v=b.createdAt?.seconds||0,h=P.createdAt?.seconds||0;if(d.key==="date")return d.direction==="asc"?v-h:h-v;if(d.key==="name"){const C=`${b.firstName} ${b.lastName}`,A=`${P.firstName} ${P.lastName}`;return d.direction==="asc"?C.localeCompare(A):A.localeCompare(C)}return 0}),g},[a,l,p,d,o]),S=Math.ceil(y.length/f),N=i.useMemo(()=>{const g=(j-1)*f;return y.slice(g,g+f)},[y,j,f]),T=async(g,b)=>{if(g.stopPropagation(),!!window.confirm(`SUPER ADMIN WARNING:

Are you sure you want to PERMANENTLY DELETE this record for ${b.firstName} ${b.lastName}?

This will remove it from the source collection. This cannot be undone.`)){w(b.id);try{let P;if(b.sourceType==="Global Pool"||b.sourceType==="Bulk Lead")P=q(U,"leads",b.id);else if(b.companyId&&b.companyId!=="general-leads"){const v=b.sourceType==="Company App"?"applications":"leads";P=q(U,"companies",b.companyId,v,b.id)}else P=q(U,"leads",b.id);await ye(P),c("Record deleted successfully."),t()}catch(P){console.error("Delete failed:",P),u("Failed to delete. Check console.")}finally{w(null)}}};return e.jsxs("div",{className:"space-y-6 h-full flex flex-col",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-200 shadow-sm flex flex-col md:flex-row gap-4 justify-between items-end md:items-center shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Unified Driver Database"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[y.length," records found across all systems"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full md:w-auto",children:[e.jsxs("div",{className:"relative",children:[e.jsx(le,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Global Search...",className:"pl-9 pr-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none w-full sm:w-64",value:l,onChange:g=>m(g.target.value)})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsxs("select",{className:"pl-9 pr-8 py-2 border border-gray-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-blue-500 outline-none appearance-none",value:p,onChange:g=>x(g.target.value),children:[e.jsx("option",{value:"All",children:"All Sources"}),e.jsx("option",{value:"Global Pool",children:"Global Pool"}),e.jsx("option",{value:"Company App",children:"Direct Applications"}),e.jsx("option",{value:"Distributed Lead",children:"Distributed Leads"}),e.jsx("option",{value:"Company Import",children:"Company Imports"})]})]})]})]}),e.jsxs("div",{className:"flex-1 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden flex flex-col",children:[e.jsx("div",{className:"overflow-auto flex-1",children:e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10 shadow-sm text-xs font-bold text-gray-500 uppercase tracking-wider",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 border-b border-gray-200",children:"Driver"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200",children:"Source / Type"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200",children:"Owner"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200",children:"Status"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200",children:"Date"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200 text-right",children:"Admin"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[N.map(g=>e.jsxs("tr",{onClick:()=>s(g),className:"hover:bg-blue-50 cursor-pointer transition-colors group",children:[e.jsxs("td",{className:"px-6 py-3",children:[e.jsxs("div",{className:"font-bold text-gray-900",children:[g.firstName," ",g.lastName]}),e.jsx("div",{className:"text-xs text-gray-400 font-mono flex gap-2",children:g.email})]}),e.jsx("td",{className:"px-6 py-3",children:e.jsx(nt,{type:g.sourceType})}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:o.get(g.companyId)||(g.companyId==="general-leads"?"System (Unassigned)":g.companyId)})}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:"inline-block px-2 py-0.5 text-xs rounded border bg-gray-50 text-gray-600 border-gray-200",children:g.status||"New"})}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-500",children:g.createdAt?.seconds?new Date(g.createdAt.seconds*1e3).toLocaleDateString():"--"}),e.jsx("td",{className:"px-6 py-3 text-right",onClick:b=>b.stopPropagation(),children:e.jsx("button",{onClick:b=>T(b,g),disabled:r===g.id,className:"p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors",title:"Delete Permanently",children:r===g.id?e.jsx(G,{size:16,className:"animate-spin"}):e.jsx(me,{size:16})})})]},g.id)),y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"p-10 text-center text-gray-400",children:"No drivers found matching your search."})})]})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 bg-gray-50 flex justify-between items-center text-sm text-gray-600",children:[e.jsxs("div",{children:["Showing ",N.length," of ",y.length]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:j===1,onClick:()=>n(g=>g-1),className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50",children:"Prev"}),e.jsx("button",{disabled:j===S,onClick:()=>n(g=>g+1),className:"px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-100 disabled:opacity-50",children:"Next"})]})]})]})]})}function it({isSearching:a,activeView:o,setActiveView:s,searchResults:t,totalSearchResults:c,allCompaniesMap:u,stats:l,statsError:m,listLoading:p,companyList:x,userList:d,allApplications:k,onViewApps:r,onEditCompany:w,onEditUser:j,onAppClick:n,onDeleteCompany:f,onDeleteUser:D,onDataUpdate:y}){if(a)return e.jsx(Hs,{results:t,totalResults:c,allCompaniesMap:u,onViewApps:r,onEditCompany:w,onEditUser:j,onAppClick:n});switch(o){case"dashboard":return e.jsx(Vs,{stats:l,statsLoading:p,statsError:m});case"analytics":return e.jsx(lt,{});case"companies":return e.jsx(Zs,{listLoading:p,statsError:m,companyList:x,onViewApps:r,onEdit:w,onDelete:f});case"users":return e.jsx(Ys,{listLoading:p,statsError:m,userList:d,allCompaniesMap:u,onEdit:j,onDelete:D});case"applications":return e.jsx(ot,{allApplications:k,allCompaniesMap:u,onAppClick:n,onDataUpdate:y});case"features":return e.jsx(Js,{companyList:x,onDataUpdate:y});case"system-health":return e.jsx(tt,{});case"bulk-lead-adding":return e.jsx(Ks,{onDataUpdate:y,onClose:()=>s("dashboard")});case"create":return e.jsx(Xs,{allCompaniesMap:u,onDataUpdate:y});default:return null}}function se({id:a,label:o,...s}){return e.jsxs("div",{children:[e.jsx("label",{htmlFor:a,className:"block text-sm font-medium text-gray-700 mb-1",children:o}),e.jsx("input",{id:a,className:"w-full p-3 border border-gray-300 rounded-lg",...s})]})}function ct({companyDoc:a,onClose:o,onSave:s}){const[t,c]=i.useState({}),[u,l]=i.useState(null),[m,p]=i.useState(""),[x,d]=i.useState(!1),[k,r]=i.useState(""),[w,j]=i.useState("");i.useEffect(()=>{if(a){const y=a.data();c({companyName:y.companyName||"",appSlug:y.appSlug||"",phone:y.contact?.phone||"",email:y.contact?.email||"",street:y.address?.street||"",city:y.address?.city||"",state:y.address?.state||"",zip:y.address?.zip||"",mcNumber:y.legal?.mcNumber||"",dotNumber:y.legal?.dotNumber||"",companyLogoUrl:y.companyLogoUrl||"",planType:y.planType||"free"}),p(y.appSlug||"")}},[a]);const n=y=>{const{id:S,value:N}=y.target;c(T=>({...T,[S]:N}))},f=y=>{y.target.files[0]?l(y.target.files[0]):l(null)},D=async()=>{d(!0),r(""),j("");let y=t.companyLogoUrl;try{u&&(r("Uploading logo..."),y=await Ve(a.id,u));const S={companyName:t.companyName,appSlug:t.appSlug.toLowerCase().trim(),address:{street:t.street,city:t.city,state:t.state.toUpperCase(),zip:t.zip},contact:{phone:t.phone,email:t.email},legal:{mcNumber:t.mcNumber,dotNumber:t.dotNumber},companyLogoUrl:y,planType:t.planType};r("Saving company data..."),await Be(a.id,S,m),r("Successfully saved!"),j("success"),await s(),setTimeout(o,1500)}catch(S){console.error("Error updating company:",S),r(S.message),j("error")}finally{d(!1)}};return e.jsx("div",{id:"edit-company-modal",className:"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col border border-gray-200",children:[e.jsxs("header",{className:"p-5 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Edit Company"}),e.jsx("button",{className:"p-2 text-gray-500 hover:bg-gray-100 rounded-full",onClick:o,children:e.jsx(de,{size:20})})]}),e.jsxs("div",{className:"p-5 overflow-y-auto space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 text-blue-800 font-bold",children:[e.jsx(js,{size:20})," Subscription Plan"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("label",{className:`flex items-center justify-between p-3 border rounded-lg cursor-pointer transition-all ${t.planType==="free"?"bg-white border-blue-500 ring-2 ring-blue-200":"bg-white border-gray-200 hover:border-blue-300"}`,children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Free Plan",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"50 Leads/Day"})]}),e.jsx("input",{type:"radio",name:"planType",id:"planType",value:"free",checked:t.planType==="free",onChange:y=>c({...t,planType:"free"}),className:"h-4 w-4 text-blue-600"})]}),e.jsxs("label",{className:`flex items-center justify-between p-3 border rounded-lg cursor-pointer transition-all ${t.planType==="paid"?"bg-white border-green-500 ring-2 ring-green-200":"bg-white border-gray-200 hover:border-green-300"}`,children:[e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Paid Plan",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-500",children:"200 Leads/Day"})]}),e.jsx("input",{type:"radio",name:"planType",id:"planType",value:"paid",checked:t.planType==="paid",onChange:y=>c({...t,planType:"paid"}),className:"h-4 w-4 text-green-600"})]})]})]}),e.jsx("hr",{className:"border-gray-100"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(se,{id:"companyName",label:"Company Name",required:!0,value:t.companyName,onChange:n}),e.jsx(se,{id:"appSlug",label:"Unique URL Slug",required:!0,value:t.appSlug,onChange:n})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"logo",className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Logo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[t.companyLogoUrl&&e.jsx("img",{src:t.companyLogoUrl,alt:"Current Logo",className:"w-16 h-16 object-contain rounded-lg border border-gray-200 p-1 bg-gray-50"}),e.jsx("input",{type:"file",id:"logo",className:"w-full p-3 border border-gray-300 rounded-lg",onChange:f,accept:"image/png, image/jpeg"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(se,{id:"phone",label:"Contact Phone",type:"tel",value:t.phone,onChange:n}),e.jsx(se,{id:"email",label:"Contact Email",type:"email",value:t.email,onChange:n})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(se,{id:"city",label:"City",value:t.city,onChange:n}),e.jsx(se,{id:"state",label:"State",value:t.state,onChange:n,maxLength:"2"}),e.jsx(se,{id:"zip",label:"ZIP Code",value:t.zip,onChange:n})]})]}),e.jsxs("footer",{className:"p-4 bg-gray-50 border-t border-gray-200 flex justify-between items-center rounded-b-xl",children:[e.jsx("p",{className:`text-sm ${w==="success"?"text-green-600":"text-red-600"}`,children:k}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"px-5 py-2 bg-gray-100 text-gray-700 font-semibold rounded-lg hover:bg-gray-200 transition-all",onClick:o,children:"Cancel"}),e.jsx("button",{className:"px-5 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-all shadow-md",onClick:D,disabled:x,children:x?"Saving...":"Save Changes"})]})]})]})})}function dt({companyId:a,companyName:o,onClose:s}){const[t,c]=i.useState(!0),[u,l]=i.useState([]),[m,p]=i.useState(""),[x,d]=i.useState("");i.useEffect(()=>{async function r(){if(a){c(!0),p("");try{const w=await bs(a);!w||w.length===0?l([]):l(w)}catch(w){console.error("Error loading applications:",w),p("Could not load applications. Please check your internet connection or permissions.")}finally{c(!1)}}}r()},[a]);const k=i.useMemo(()=>{const r=x.toLowerCase();return r?u.filter(w=>{const j=`${w.firstName||""} ${w.lastName||""}`.toLowerCase(),n=(w.email||"").toLowerCase(),f=(w.status||"").toLowerCase();return j.includes(r)||n.includes(r)||f.includes(r)}):u},[x,u]);return e.jsx("div",{id:"view-apps-modal",className:"fixed inset-0 bg-gray-900/60 backdrop-blur-sm flex items-center justify-center p-4 z-[60]",onClick:s,children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[85vh] flex flex-col border border-gray-200 overflow-hidden animate-in zoom-in-95 duration-200",onClick:r=>r.stopPropagation(),children:[e.jsxs("header",{className:"p-5 border-b border-gray-200 flex justify-between items-center bg-gray-50 shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(re,{className:"text-blue-600"})," Driver Applications"]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Viewing records for ",e.jsx("span",{className:"font-semibold text-gray-900",children:o})]})]}),e.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-full transition-colors",onClick:s,children:e.jsx(de,{size:24})})]}),e.jsx("div",{className:"p-4 border-b border-gray-200 bg-white shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Filter by driver name, email, or status...",className:"w-full p-2.5 pl-10 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none",value:x,onChange:r=>d(r.target.value)}),e.jsx(le,{size:18,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-0 bg-gray-50",children:[t&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx(G,{className:"animate-spin mb-2",size:32}),e.jsx("p",{children:"Loading records..."})]}),m&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-red-600 px-6 text-center",children:[e.jsx(ms,{size:32,className:"mb-2"}),e.jsx("p",{children:m})]}),!t&&!m&&k.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400",children:[e.jsx(Oe,{size:48,className:"mb-2 opacity-20"}),e.jsx("p",{children:x?"No matches found.":"No applications submitted yet."})]}),!t&&!m&&e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"bg-gray-100 text-xs font-bold text-gray-500 uppercase sticky top-0 z-10 shadow-sm",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 border-b border-gray-200",children:"Driver Name"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200",children:"Contact"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200 text-center",children:"Status"}),e.jsx("th",{className:"px-6 py-3 border-b border-gray-200 text-right",children:"Date"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:k.map(r=>e.jsxs("tr",{className:"hover:bg-blue-50 transition-colors",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsxs("span",{className:"font-bold text-gray-900 block",children:[R(r["first-name"])||R(r.firstName)," ",R(r["last-name"])||R(r.lastName)]}),e.jsx("span",{className:"text-xs text-gray-400 font-mono",children:r.id})]}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-600",children:[e.jsx("div",{children:R(r.email)}),e.jsx("div",{className:"text-xs text-gray-400",children:R(r.phone)})]}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("span",{className:`inline-flex px-2.5 py-1 rounded-full text-xs font-bold border ${$e(r.status||"New Application").replace("bg-","bg-opacity-10 bg-").replace("text-","border-")}`,children:r.status||"New Application"})}),e.jsx("td",{className:"px-6 py-4 text-right text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(xs,{size:12}),r.submittedAt?.seconds?new Date(r.submittedAt.seconds*1e3).toLocaleDateString():r.createdAt?.seconds?new Date(r.createdAt.seconds*1e3).toLocaleDateString():"--"]})})]},r.id))})]})]}),e.jsx("footer",{className:"p-4 bg-gray-50 border-t border-gray-200 flex justify-end items-center rounded-b-xl shrink-0",children:e.jsx("button",{className:"px-6 py-2 bg-white border border-gray-300 text-gray-700 font-bold rounded-lg hover:bg-gray-100 transition-all shadow-sm",onClick:s,children:"Close View"})})]})})}function mt({companyId:a,companyName:o,onClose:s,onConfirm:t}){const[c,u]=i.useState(!1),[l,m]=i.useState(""),p=async()=>{u(!0),m("");try{await te(ae,"deleteCompany")({companyId:a}),await t(),s()}catch(x){console.error("Error deleting company:",x),m(x.message),u(!1)}};return e.jsx("div",{id:"delete-company-modal",className:"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg border border-gray-200",children:[e.jsxs("header",{className:"p-5 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-2xl font-bold text-red-700 flex items-center gap-2",children:[e.jsx(Le,{}),"Delete Company?"]}),e.jsx("button",{className:"p-2 text-gray-500 hover:bg-gray-100 rounded-full",onClick:s,children:e.jsx(de,{size:20})})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("p",{className:"text-gray-600 mb-2",children:["Are you sure you want to delete ",e.jsx("strong",{className:"font-bold text-gray-900",children:o}),"?"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"This is a destructive action. It will permanently delete the company, all its users, all applications, and all associated files. This cannot be undone."}),l&&e.jsx("p",{id:"delete-company-error",className:"text-sm text-red-600 mb-4 p-3 bg-red-50 rounded-lg border border-red-200",children:l})]}),e.jsxs("footer",{className:"p-4 bg-gray-50 border-t border-gray-200 flex justify-end gap-4 rounded-b-xl",children:[e.jsx("button",{className:"px-5 py-2 bg-gray-100 text-gray-700 font-semibold rounded-lg hover:bg-gray-200 transition-all",onClick:s,disabled:c,children:"Cancel"}),e.jsx("button",{className:"px-5 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 disabled:opacity-50 transition-all shadow-md",onClick:p,disabled:c,children:c?"Deleting...":"Delete Company"})]})]})})}function xt({userId:a,userName:o,onClose:s,onConfirm:t}){const[c,u]=i.useState(!1),[l,m]=i.useState(""),p=async()=>{u(!0),m("");try{await te(ae,"deletePortalUser")({userId:a}),await t(),s()}catch(x){console.error("Error deleting user:",x),m(x.message),u(!1)}};return e.jsx("div",{id:"delete-user-modal",className:"fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-lg border border-gray-200",children:[e.jsxs("header",{className:"p-5 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("h2",{className:"text-2xl font-bold text-red-700 flex items-center gap-2",children:[e.jsx(Le,{}),"Delete User?"]}),e.jsx("button",{className:"p-2 text-gray-500 hover:bg-gray-100 rounded-full",onClick:s,children:e.jsx(de,{size:20})})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("p",{className:"text-gray-600 mb-2",children:["Are you sure you want to delete ",e.jsx("strong",{className:"font-bold text-gray-900",children:o}),"?"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"This is a destructive action. It will permanently delete the user's login, their user profile, and all their company memberships. This cannot be undone."}),l&&e.jsx("p",{id:"delete-user-error",className:"text-sm text-red-600 mb-4 p-3 bg-red-50 rounded-lg border border-red-200",children:l})]}),e.jsxs("footer",{className:"p-4 bg-gray-50 border-t border-gray-200 flex justify-end gap-4 rounded-b-xl",children:[e.jsx("button",{className:"px-5 py-2 bg-gray-100 text-gray-700 font-semibold rounded-lg hover:bg-gray-200 transition-all",onClick:s,disabled:c,children:"Cancel"}),e.jsx("button",{className:"px-5 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 disabled:opacity-50 transition-all shadow-md",onClick:p,disabled:c,children:c?"Deleting...":"Delete User"})]})]})})}function pt({editingCompanyDoc:a,deletingCompany:o,editingUser:s,deletingUser:t,viewingCompanyApps:c,selectedApplication:u,allCompaniesMap:l,onClose:m,onRefreshData:p,onPhoneClick:x}){return e.jsxs(e.Fragment,{children:[a&&e.jsx(ct,{companyDoc:a,onClose:m,onSave:p}),o&&e.jsx(mt,{companyId:o.id,companyName:o.name,onClose:m,onConfirm:p}),s&&e.jsx(vs,{userId:s.id,allCompaniesMap:l,onClose:m,onSave:p}),t&&e.jsx(xt,{userId:t.id,userName:t.name,onClose:m,onConfirm:p}),c&&e.jsx(dt,{companyId:c.id,companyName:c.name,onClose:m}),u&&e.jsx(fs,{companyId:u.companyId,applicationId:u.appId,onClosePanel:m,onStatusUpdate:p,isCompanyAdmin:!0,onPhoneClick:x})]})}function St(){const{handleLogout:a}=ps(),{showSuccess:o,showError:s,showInfo:t}=Pe(),[c,u]=i.useState("dashboard"),{companyList:l,userList:m,allApplications:p,allCompaniesMap:x,stats:d,loading:k,statsError:r,searchQuery:w,setSearchQuery:j,searchResults:n,totalSearchResults:f,refreshData:D}=qs(),[y,S]=i.useState(null),[N,T]=i.useState(null),[g,b]=i.useState(null),[P,v]=i.useState(null),[h,C]=i.useState(null),[A,z]=i.useState(null),[L,F]=i.useState(!1),[E,I]=i.useState(!1),[K,X]=i.useState(!1),ne=w.length>0,Ne=()=>{S(null),T(null),b(null),v(null),C(null),z(null)},we=async $=>{try{const _=await De(q(U,"companies",$));_.exists()&&S(_)}catch(_){console.error("Error opening edit company:",_),s("Could not load company details.")}},xe=$=>{z({companyId:$.companyId,appId:$.id})},M=($,_)=>{$&&$.stopPropagation(),_&&_.phone?window.location.href=`tel:${_.phone}`:s("No phone number available for this driver.")},O=async()=>{if(window.confirm("Are you sure you want to distribute daily leads? This will FORCE ROTATE current leads.")){F(!0),t("Distribution started. This may take up to 30 seconds...");try{const _=await te(ae,"distributeDailyLeads")(),Ie=_.data.details||[],Ye=Ie.length>0?Ie.join(`
`):"Distribution complete.";console.log("Distribution Result:",_.data),o("Success! Check console for details."),alert(`Distribution Report:
`+Ye),D()}catch($){console.error("Distribution Failed:",$),s("Error distributing leads: "+$.message)}finally{F(!1)}}},J=async()=>{if(window.confirm("Run database migration to copy DRIVERS to LEADS? This is required if the pool is empty.")){I(!0),t("Starting migration... this may take a moment.");try{const _=await te(ae,"migrateDriversToLeads")();o(_.data.message),D()}catch($){console.error("Migration Failed:",$),s("Migration failed: "+$.message)}finally{I(!1)}}},ee=async()=>{X(!0),t("Purging trash leads...");try{const _=await te(ae,"cleanupBadLeads")();o(_.data.message),D()}catch($){console.error("Cleanup Failed:",$),s("Cleanup failed: "+$.message)}finally{X(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{id:"super-admin-container",className:"min-h-screen bg-gray-50",children:[e.jsx(Gs,{searchQuery:w,setSearchQuery:j,onDistribute:O,distributing:L,onFixData:J,fixingData:E,onCleanup:ee,cleaning:K,onLogout:a}),e.jsxs("div",{className:"container mx-auto p-4 sm:p-8 flex gap-8 items-start",children:[e.jsx(Os,{activeView:c,setActiveView:u,isSearching:ne,onClearSearch:()=>j("")}),e.jsx("main",{className:"flex-1 w-full min-w-0",children:e.jsx(it,{isSearching:ne,activeView:c,setActiveView:u,searchResults:n,totalSearchResults:f,allCompaniesMap:x,stats:d,statsError:r,listLoading:k,companyList:l,userList:m,allApplications:p,onViewApps:C,onEditCompany:we,onEditUser:b,onAppClick:xe,onDeleteCompany:T,onDeleteUser:v,onDataUpdate:D})})]})]}),e.jsx(pt,{editingCompanyDoc:y,deletingCompany:N,editingUser:g,deletingUser:P,viewingCompanyApps:h,selectedApplication:A,allCompaniesMap:x,onClose:Ne,onRefreshData:D,onPhoneClick:M})]})}export{St as SuperAdminDashboard};
